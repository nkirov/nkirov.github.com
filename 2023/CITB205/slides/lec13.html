<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="Author" content="Nikolay Kirov">
    <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U)
      [Netscape]">
    <title>lec13</title>
  </head>
  <body>
    <center>
      <h3 align="left">13. Обработка на изключения</h3>
    </center>
    <i>План:</i><br>
    Обработка на грешки<br>
    Изхвърляне на изключения<br>
    Прихващане на изключения<br>
    Развиване на стека<br>
    Спецификации на изключенията<br>
    <hr size="2" width="100%"><br>
    *** <b>Обработка на грешки<br>
      <br>
    </b>До сега за обработка на грешки - <a
      href="../../CITB107/slides/ch08/lecture_8.html">Макрос assert</a><b>.<br>
    </b> Как да се обработват (логически) грешки, възникващи във функция
    или клас?<br>
    <br>
    <i>Пример: </i>Да се пресметне стойността на влог с начална сума
    1000 лв. след 10 години с годишната лихва да е p%.&nbsp; Да се
    използва се формулата за пресмятане на <a
href="https://www.google.com/search?q=%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%B0+%D0%BB%D0%B8%D1%85%D0%B2%D0%B0&amp;oq=%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%B0+%D0%BB%D0%B8%D1%85%D0%B2%D0%B0&amp;aqs=chrome..69i57.16359j0j7&amp;sourceid=chrome&amp;ie=UTF-8">сложна







      лихва</a>.&nbsp; (<a
      href="../../CITB107/slides/ch05/lecture_5a.html">Функции I</a>)<br>
    <font size="+1">
      <pre><font size="+1"><span style="color: rgb(0, 153, 0); font-weight: bold;">double</span> <span style="color: rgb(153, 51, 153); font-weight: bold;">future_value</span>(<span style="color: rgb(0, 153, 0);">double</span> initial_balance, <span style="color: rgb(0, 153, 0); font-weight: bold;">double</span> p, <span style="color: rgb(0, 153, 0); font-weight: bold;">int</span> n)<br>{  <span style="color: rgb(0, 153, 0); font-weight: bold;">double</span> b = initial_balance * <span style="font-weight: bold; color: rgb(153, 51, 153);">pow</span>(1 + p / 100, n);<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">return</span> b;<br>}</font></pre>
    </font><tt><font size="+1">cout &lt;&lt; future_value(1000, -100,
        -1);</font></tt> <br>
    <br>
    ** Не се проверяват условия за грешки и се изпълнява програмата.
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font><br></pre>
    ** Проверяват се условията за грешка, не се прави нищо в случай на
    грешка (връща се фалшива стойност).<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0) </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> 0;</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    ** Проверяват се условията за грешка, съобщава се за грешката и се
    спира изпълнението на програмата. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  assert(p &gt;= 0 &amp;&amp; n &gt;= 0);</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    Въникващи проблеми:<br>
    ** Ако не се прави проверка за грешка, програмата е ненадеждна.<br>
    ** Ако се върне фалшива стойност, програмата продължава да използва
    стойността - никой не знае къде и каква е грешката.<br>
    ** Много реални програми не могат да бъдат спирани като тези, които
    управляват ракета, самолет или медицинско устройство.<br>
    <hr size="2" width="100%"> <b><br>
      *** Изхвърляне на изключения<br>
      <br>
    </b> C++ има механизъм за уведомяване и обработка на изключения. <br>
    Когато дадена функция открие грешка, тя може да сигнализира за
    това&nbsp; състояние (да изхвърли изключение), като премине&nbsp;
    към някоя друга част на програмата, чиято работа е да обработва
    грешки.&nbsp; <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n) </b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>   {  </b><b>logic_error</b><b> <font color="#cc0000">description</font>("illegal future_value parameter");</b><b><br></b><b>      </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> description;  </b>// изхвърля изключението </font><font size="+1"><font size="+1">description</font><b>   <br>   }</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    Може да не се задава име на обекта за обработка на изключения:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{ </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>    </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> </b><b>logic_error</b><b>("illegal future_value parameter");</b><b><br></b><b> </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><br>}</font></pre>
    <span style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> е стандартен клас за изключения,
    който е дефиниран в заглавния файл&nbsp; <span style="color: rgb(0,
      0, 0); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">stdexcept</span>.<br>
    <br>
    Ключовата дума <font size="+1"><tt>throw</tt> </font>показва, че
    изпълнението на функциятя спира незабавно, но управлението не се
    връща на извикващата функция, а се търси частта от програмата за
    обработка на изключения.<br>
    <hr size="2" width="100%"> <b><br>
      *** Прихващане на изключения</b><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br>   // <i>code</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>{<br>   <i>// handler</i><br>}</font></pre>
    Ако някоя от функциите в блока <span style="color: rgb(51, 51,
      255); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: bold; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">try</span>
    изхвърли изключение от тип&nbsp; <span style="color: rgb(0, 0, 0);
      font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">logic_error</span>,
    или вика друга функция, която изхвърля такова изключение, блокът на
    <b><tt><span style="color: rgb(0, 0, 0); font-size: large;
          font-style: normal; font-variant: normal; font-weight: normal;
          letter-spacing: normal; line-height: normal; text-align: left;
          text-indent: 0px; text-transform: none; white-space: normal;
          word-spacing: 0px; background-color: rgb(255, 255, 255);
          display: inline ! important; float: none;"><b><font
              color="#3366ff">catch</font>(</b></span></tt></b><b><tt><span
          style="color: rgb(0, 0, 0); font-size: large; font-style:
          normal; font-variant: normal; font-weight: normal;
          letter-spacing: normal; line-height: normal; text-align: left;
          text-indent: 0px; text-transform: none; white-space: normal;
          word-spacing: 0px; background-color: rgb(255, 255, 255);
          display: inline ! important; float: none;"><b><span
              style="color: rgb(0, 0, 0); font-family: monospace;
              font-size: large; font-style: normal; font-variant:
              normal; font-weight: normal; letter-spacing: normal;
              line-height: normal; orphans: auto; text-align: left;
              text-indent: 0px; text-transform: none; white-space:
              normal; widows: auto; word-spacing: 0px;
              -webkit-text-size-adjust: auto; -webkit-text-stroke-width:
              0px; background-color: rgb(255, 255, 255); display: inline
              !important; float: none;">logic_error</span>)</b></span></tt></b>
    се изпълнява веднага.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">while</span> (more)<br>{  <span style="color: rgb(51, 51, 255); font-weight: bold;">try</span> <br>   {<br>      <i>// code</i><br>   }<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>   {  cout &lt;&lt; "A logic error has occurred "<br>           &lt;&lt; e.what() &lt;&lt; "\n";<br>      ........<br>   }<br>}</font></pre>
    Член-функцията <b><span style="color: rgb(0, 0, 0); font-family:
        monospace; font-size: large; font-style: normal; font-variant:
        normal; font-weight: normal; letter-spacing: normal;
        line-height: normal; orphans: auto; text-align: left;
        text-indent: 0px; text-transform: none; white-space: normal;
        widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
        -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
        255); display: inline !important; float: none;">what</span></b>
    от класа <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: bold; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> връща низа, който е зададен като
    параметър при конструиране на обекта в оператора <span
      style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;"><tt>throw</tt><span class="Apple-converted-space"></span></span>.<br>
    <br>
    <table cellpadding="4" border="1" bgcolor="#00ffff">
      <tbody>
        <tr>
          <td bgcolor="#ffffff">
            <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{</font><i><font size="+1"><br></font></i><font size="+1"> <i>statements</i> <br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>1</sub> <i>variable_name</i><sub>1</sub>)<br>{<br> <i>statements</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>2</sub> <i>variable_name</i><sub>2</sub>)<br>{<br> <i>statements</i><br>}<br>...<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>n</sub> <i>variable_name</i><sub>n</sub>)<br>{<br> <i>statements</i><br>}</font></pre>
            <table cellpadding="4" border="0">
              <tbody>
                <tr>
                  <td valign="top"><font size="+1" color="#00ffff"><font
                        size="+1">Пример</font>:</font></td>
                  <td>
                    <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br> double fvalue = future_value(init, interest, years); <br> cout &lt;&lt; "The future value is " &lt;&lt; fvalue &lt;&lt; endl;<br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span>(logic_error&amp; e)<br>{<br> cout &lt;&lt; "Processing error " &lt;&lt; e.what() &lt;&lt; "\n";<br>}</font></pre>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    <tt>//</tt><tt><a href="../sources/ch17/exception1.cpp">exception1.cpp</a></tt><tt><br>
      <br>
    </tt><tt> </tt><tt><font size="3"> #</font></tt><tt>include
      &lt;iostream&gt;</tt><tt><br>
    </tt><tt> </tt><tt><font color="#008000">#include </font></tt><tt>&lt;stdexcept&gt;</tt><tt><br>
    </tt><tt> </tt><code><font><font><font><font size="3"><font
                color="#000000"><font color="#008000">#include</font></font></font></font></font></font></code><code><font
        size="3"><font color="#000000"><tt> &lt;cmath&gt;<br>
            <br>
          </tt></font></font><font face="Courier New" size="3"><font
          color="#000000"> <b>using namespace </b>std;<br>
          <br>
          <b>double </b>future_value(<b>double </b>initial_balance, <b>double




          </b>p, <b>int </b>n)<br>
          { <b><br>
            &nbsp;&nbsp;&nbsp; if </b>(p &lt; <font color="#800080">0
          </font>|| n &lt; <font color="#800080">0</font>)<br>
          &nbsp;&nbsp;&nbsp; { logic_error description(<font
            color="#ff0000">"illegal future_value parameter"</font>);<br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; throw </b>description;<br>
          &nbsp;&nbsp;&nbsp; }<br>
          <b>&nbsp;&nbsp;&nbsp; return </b>initial_balance * pow(<font
            color="#800080">1 </font>+ p / <font color="#800080">100</font>,
          n);<br>
          }<br>
          <br>
          <b>int </b>main()<br>
          { <br>
          &nbsp;&nbsp;&nbsp; <b>bool </b>more = <b>true</b>;<br>
          <b>&nbsp;&nbsp;&nbsp; while </b>(more)<br>
          &nbsp;&nbsp;&nbsp; { <b><br>
            &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; double </b>init,
          interest;<br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; int </b>years;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cout &lt;&lt; <font
            color="#ff0000">"Enter initial value, interest and years: "</font>;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cin &gt;&gt; init
          &gt;&gt; interest &gt;&gt; years;<br>
          <br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; try <br>
          </b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <b>double

          </b>fvalue = future_value(init, interest, years); <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cout
          &lt;&lt; <font color="#ff0000">"The future value is " </font>&lt;&lt;




          fvalue &lt;&lt; endl; <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; }<br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; catch </b>(logic_error&amp;

          e)<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; { <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
          &nbsp;&nbsp;&nbsp; cout &lt;&lt; <font color="#ff0000">"A
            logic error has occurred "</font> &lt;&lt; e.what() &lt;&lt;
          <font color="#ff0000">"\n"</font>;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; } <br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cout
          &lt;&lt; <font color="#ff0000">"Retry? (y/n)"</font>;<br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; char </b>input;<br>
          &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; cin &gt;&gt; input;<br>
          <b>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; if </b>(input ==
          'n') more = <b>false</b>;<br>
          } <br>
          <font color="#000080"><i>&nbsp;&nbsp;&nbsp;&nbsp; </i></font><b>return

          </b><font color="#800080">0</font>;<br>
          }<br>
        </font></font></code>
    <table width="100%" cellspacing="2" cellpadding="2" border="1">
      <tbody>
        <tr>
          <td valign="top"><font size="+1"><code><font face="Courier
                  New">nkirov@cpp % c++ exception1.cpp<br>
                  nkirov@cpp % ./a.out<br>
                  Enter initial value, interest and years: 100 10 2<br>
                  The future value is 121<br>
                  Retry? (y/n)y<br>
                  Enter initial value, interest and years: 100 -10 3<br>
                  A logic error has occurred illegal future_value
                  parameter<br>
                  Retry? (y/n)n<br>
                  nkirov@cpp %</font></code></font><br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    Добре е всяко изключение да се дефинира като отделен клас. <br>
    <br>
    <i>Пример:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">class</span> FutureValueError : <span style="color: rgb(51, 51, 255);">public</span> <span style="font-weight: bold;">logic_error</span> {<br><span style="color: rgb(51, 51, 255);">public:</span><br>   FutureValueError(<span style="color: rgb(51, 51, 255);">const</span> <span style="color: rgb(51, 51, 255);">char</span> reason[]);<br>};<br><br>FutureValueError::FutureValueError(<span style="color: rgb(51, 51, 255);">const</span> <span style="color: rgb(51, 51, 255);">char</span> reason[])<br>   : <span style="font-weight: bold;">logic_error</span>(reason){}</font></pre>
    Функцията <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">future_value</span>
    може да изхвърли <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">FutureValueError</span>&nbsp; обект:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">if</span> (p &lt; 0 || n &lt; 0)<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> FutureValueError("illegal parameter");</font></pre>
    Тъй като<b> </b><b><span style="color: rgb(0, 0, 0); font-family:
        monospace; font-size: large; font-style: normal; font-variant:
        normal; font-weight: normal; letter-spacing: normal;
        line-height: normal; orphans: auto; text-align: left;
        text-indent: 0px; text-transform: none; white-space: normal;
        widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;
        background-color: rgb(255, 255, 255); display: inline
        !important; float: none;">FutureValueError</span></b><b>&nbsp;</b>
    е&nbsp;<b> </b><b><font size="+1"><tt style="color: rgb(0, 0, 0);
          font-style: normal; font-variant: normal; letter-spacing:
          normal; line-height: normal; text-align: left; text-indent:
          0px; text-transform: none; white-space: normal; word-spacing:
          0px; -webkit-text-stroke-width: 0px; background-color:
          rgb(255, 255, 255);">logic_error</tt></font></b><b><span
        style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
        font-size: large; font-style: normal; font-variant: normal;
        font-weight: normal; letter-spacing: normal; line-height:
        normal; orphans: auto; text-align: left; text-indent: 0px;
        text-transform: none; white-space: normal; widows: auto;
        word-spacing: 0px; -webkit-text-stroke-width: 0px;
        background-color: rgb(255, 255, 255); display: inline
        !important; float: none;"></span></b><b> </b>(наследяване), то
    това изключение може да се прихване от<span style="font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;"> catch</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">(</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); font-weight: bold;">logic_erro</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">r&amp;&nbsp;e).</span><br>
    <br>
    Разбира се, може да построим и специално за него <span
      style="font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); color: rgb(51, 51, 255);
      font-weight: bold;">catch</span> блок:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br>   <i>// code</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (FutureValueError&amp; e)<br>{<br>   <i>// handler</i><sub>1</sub><br>} <br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (logic_error&amp; e)<br>{<br>   <i>// handler</i><sub>2</sub><br>}</font></pre>
    В този случай ще се изпълни само първия <span style="font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;">catch</span>
    блок.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code><font face="Courier New" size="3"><font color="#008000">// <font size="3"><a href="../sources/ch17/exception2.cpp">exception2.cpp</a><br><br></font>#include </font>&lt;iostream&gt;<br><font color="#008000">#include </font>&lt;stdexcept&gt;<br></font></code><code></code><code><font><font><font><font face="Courier New" size="3"><font color="#000000"><font color="#008000">#include</font></font></font></font></font></font></code><code><font face="Courier New" size="3"><font color="#000000"> &lt;cmath&gt;</font></font></code><br><code><font face="Courier New" size="3"><b>using namespace </b>std;<br> <br><b>class </b>FutureValueError : <b>public </b>logic_error {<br><b>public</b>:<br>   FutureValueError(<b>const char </b>reason[]);<br>};<br><br>FutureValueError::FutureValueError(<b>const char </b>reason[])<br>   : logic_error(reason){}<br><br><b>double </b>future_value(<b>double </b>initial_balance, <b>double </b>p, <b>int </b>n)<br>{  <b>if </b>(p &lt; <font color="#800080">0 </font>|| n &lt; <font color="#800080">0</font>)<br>     <b>throw </b>FutureValueError(<font color="#ff0000">"illegal future_value parameter"</font>);<br>   <b>return </b>initial_balance * pow(<font color="#800080">1 </font>+ p / <font color="#800080">100</font>, n);<br>}<br><br><b>void </b>read(<b>double</b>&amp; init, <b>double</b>&amp; interest, <b>int</b>&amp; years)<br>{  cout &lt;&lt; <font color="#ff0000">"Enter initial value, interest and years: "</font>;<br>   cin &gt;&gt; init &gt;&gt; interest &gt;&gt; years;<br>   <b>if </b>(years &gt; <font color="#800080">100</font>) <b>throw </b>logic_error(<font color="#ff0000">"too many years!"</font>);<br>   cout &lt;&lt; init &lt;&lt; <font color="#ff0000">" " </font>&lt;&lt; interest &lt;&lt; <font color="#ff0000">" " </font>&lt;&lt; years &lt;&lt; endl;<br>}<br><br><b>int </b>main()<br>{  <b>bool </b>more = <b>true</b>;<br>   <b>while </b>(more)<br>    {  <b>double </b>init, interest;<br>       <b>int </b>years;<br>       <b>try<br>       </b>{  read(init, interest, years);<br>          <b>double </b>fvalue = future_value(init, interest, years); <br>          cout &lt;&lt; <font color="#ff0000">"The future value is " </font>&lt;&lt; fvalue &lt;&lt; endl;  <br>       }<br>       <font color="#000080"><i>/**/<br>       </i></font><b>catch </b>(FutureValueError&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A FutureValueError has occurred: "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       } <br>       <font color="#000080"><i>/**/      <br>       </i></font><b>catch </b>(logic_error&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A logic error has occurred: "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       }       <br>       cout &lt;&lt; <font color="#ff0000">"Retry? (y/n)"</font>;<br>       <b>char </b>input;<br>       cin &gt;&gt; input;<br>       <b>if </b>(input == 'n') more = <b>false</b>;<br>    } <font color="#000080"><i><br>    </i></font><b>return </b><font color="#800080">0</font>;<br> }<br></font></code></pre>
    <table width="100%" cellspacing="2" cellpadding="2" border="1">
      <tbody>
        <tr>
          <td valign="top"><code><font size="3"><font face="Courier New">nkirov@cpp





                  % c++ exception2.cpp<br>
                  nkirov@cpp % ./a.out<br>
                  Enter initial value, interest and years: 100 10 2<br>
                  100 10 2<br>
                  The future value is 121<br>
                  Retry? (y/n)y<br>
                  Enter initial value, interest and years: 100 -10 2<br>
                  100 -10 2<br>
                  A FutureValueError has occurred: illegal future_value
                  parameter<br>
                  Retry? (y/n)y<br>
                  Enter initial value, interest and years: 100 10 200<br>
                  A logic error has occurred: too many years!<br>
                  Retry? (y/n)n<br>
                  nkirov@cpp %</font></font></code><br>
          </td>
        </tr>
      </tbody>
    </table>
    <hr size="2" width="100%"> <b><br>
      *** Развиване на стека<br>
      <br>
    </b> Често механизмът за обработка на изключения се прилага при вход
    на данни. <br>
    <br>
    <i>Пример</i>: (<a href="../../CITB107/sources/ch6/product2.cpp"><b><tt>product2.cpp</tt></b></a>).<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">bool</span> Product::read(fstream&amp; fs)<br>{  getline(fs, name);<br>   <span style="color: rgb(51, 51, 255);">if</span> (name == "") <span style="color: rgb(51, 102, 255);">return</span> false; // end of file<br>   fs &gt;&gt; price &gt;&gt; score;<br>   <span style="color: rgb(51, 51, 255);">if</span> (fs.fail())<br>      <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> <span style="font-weight: bold;">runtime_error</span>("Error while reading product");<br>   string remainder;<br>   getline(fs, remainder);<br>   <span style="color: rgb(51, 51, 255);">return</span> true;<br>}</font></pre>
    Когато възникне логическа грешка, няма смисъл да се повтори същата
    операция, но при <font size="+1"><tt>runtime_error</tt></font> има
    шанс да се повтори операцията и грешката да се избегне. <br>
    <br>
    Има съществена разлика при обработката на край на файла (<font
      size="+1"><tt>return</tt></font>) и грешка при входа (<font
      size="+1"><tt>throw</tt></font>). <br>
    <br>
    Йерархията на стандартните класове за обработка на изключения е
    следната:<br>
    <img alt=""
      src="../../../2014/NETB151/slides/ch17/images/exceptions.png"
      height="431" width="756"><br>
    <br>
    Нека имаме следната функция (<tt><a
        href="../../CITB107/sources/ch9/bestval2.cpp">bestval2.cpp</a></tt>):<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>{  vector&lt;Product&gt; products;<br>   <span style="color: rgb(51, 51, 255);">bool</span> more = true;<br>   <span style="color: rgb(51, 51, 255);">while</span> (more)<br>   {  Product p;<br>      <span style="color: rgb(51, 51, 255);">if</span> (p.read(fs)) products.push_back(p);<br>      <span style="color: rgb(51, 51, 255);">else</span> more = false;<br>   }<br>   <i>// do something with</i> products<br>}</font></pre>
    Когато функцията <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">read</span> изхвърли изключение, функцията <span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">process_products</span>
    прекъсва и механизмът за обработка на изключения търси подходящ <span
      style="color: rgb(51, 51, 255); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      bold; letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">catch</span> блок.
    <br>
    При прекъсването се изпълняват всички деструктори на локалните
    обекти. <br>
    В случая обектът&nbsp; <span style="color: rgb(0, 0, 0);
      font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">products</span> (от класа&nbsp; <span style="color:
      rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: large;
      font-style: normal; font-variant: normal; font-weight: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">vector</span>) ще
    бъде унищожен.<br>
    Когато имаме указатели, трябва да се погрижим за унищожаването на
    обектите в динамичната памет.<br>
    <i><br>
      Пример:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1">Product* p = <span style="color: rgb(51, 51, 255);">new</span> Product();<br><span style="color: rgb(51, 51, 255);">if</span> (p-&gt;read())<br>{<br>   ...<br>}<br><span style="color: rgb(51, 51, 255);">delete</span> p; // never executes if read throws an exception</font></pre>
    Този код генерира "memory leak", ако функцията <span style="color:
      rgb(0, 0, 0); font-family: monospace; font-size: large;
      font-style: normal; font-variant: normal; font-weight: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">read</span>
    изхвърли изключение (виж <a href="../sources/ch17/product1.cpp"><tt>product1.cpp</tt></a>).

























    <br>
    В такъв случай може да се използва следната конструкция:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1">Product* p = NULL;<br><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{  p = <span style="color: rgb(51, 51, 255);">new</span> Product();<br>   if (p-&gt;read())<br>   {<br>      ...<br>   }<br>   <span style="color: rgb(51, 51, 255);">delete</span> p;<br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span>(...)<br>{  <span style="color: rgb(51, 51, 255);">delete</span> p;<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span>;<br>}</font></pre>
    Блокът <span style="font-family: monospace; font-size: large;
      font-style: normal; font-variant: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); color: rgb(51, 51, 255);
      font-weight: bold;">catch</span><span style="color: rgb(0, 0, 0);
      font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">(...)</span> обработва всяко изключение, а
    операторът <span style="color: rgb(51, 51, 255); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: bold; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">throw</span>&nbsp; без обект изпраща изключението да
    се обработва от друг <span style="font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;">catch</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;"></span> блок.<br>
    <br>
    <font size="+1"><tt>// <a href="../sources/ch17/product2.cpp">product2.cpp</a><br>
        #include &lt;iostream&gt;</tt><tt><br>
      </tt><tt>#include &lt;fstream&gt;</tt><tt><br>
      </tt><tt>#include &lt;stdexcept&gt;</tt><tt><br>
      </tt><tt>#include &lt;vector&gt;</tt><tt><br>
      </tt><tt>using namespace std;</tt><tt><br>
      </tt><tt>&nbsp;</tt><tt><br>
      </tt><tt>class Product {</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; public:</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Product();</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bool
        read(istream&amp; fs);</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void print() const;
      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp; private:</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string name;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; double price;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int score;</tt><tt><br>
      </tt><tt>};&nbsp;&nbsp;&nbsp; </tt><tt><br>
      </tt><tt><br>
      </tt><tt>Product::Product()</tt><tt><br>
      </tt><tt>{ price = 0;</tt><tt><br>
      </tt><tt>&nbsp; score =
        0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>bool Product::read(istream&amp; fs)</tt><tt><br>
      </tt><tt>{&nbsp; cout &lt;&lt; "Product: ";</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; getline(fs, name);</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; if (name == "") return false; // end of file</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; fs &gt;&gt; price &gt;&gt; score;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; if (fs.fail())</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; throw runtime_error("Error
        while reading product");</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; string remainder;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; getline(fs, remainder);&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>&nbsp;&nbsp; return true;</tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>void Product::print() const</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; name &lt;&lt; " " &lt;&lt; price &lt;&lt;
        " " &lt;&lt; score &lt;&lt; endl;</tt><tt><br>
      </tt><tt>} </tt><tt><br>
      </tt><tt>&nbsp; </tt><tt><br>
      </tt><tt>void process_products(istream&amp; fs)</tt><tt><br>
      </tt><tt>{&nbsp; vector&lt;Product*&gt; products;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; bool more = true;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; while (more)</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; {&nbsp; Product* p = new Product;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp; if
        (p-&gt;read(fs)) products.push_back(p);</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else
        more = false;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; catch(runtime_error&amp;
        r)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        // runtime_error&amp; r)</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp; cout &lt;&lt; "1.
        " &lt;&lt; r.what() &lt;&lt; endl;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (int
        i = 0; i &lt; products.size(); i++)</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











        delete products[i];</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        throw;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        return;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>&nbsp;&nbsp; /* processing products
        */&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>&nbsp;&nbsp; cout &lt;&lt; "Print:" &lt;&lt; endl;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; for (int i = 0; i &lt; products.size(); i++)</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; {&nbsp; products[i]-&gt;print();</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; delete products[i];</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>&nbsp;int main()</tt><tt><br>
      </tt><tt>&nbsp;{&nbsp; try</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; {&nbsp; process_products(cin);</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; }</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; catch(runtime_error&amp;
        r)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;







        // runtime_error&amp; r)</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; { cout &lt;&lt; "2. " &lt;&lt;
        r.what() &lt;&lt;
        endl;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;
        }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;











      </tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; return 0;</tt><tt><br>
      </tt><tt>&nbsp;}<br>
      </tt></font>
    <table width="100%" cellspacing="2" cellpadding="2" border="1">
      <tbody>
        <tr>
          <td valign="top"><tt><font size="+1">nkirov@cpp % c++
                product2.cpp<br>
                nkirov@Kcpp % ./a.out<br>
                Product: ABC<br>
                1000 20<br>
                Product: ZDR<br>
                2000 AA<br>
                1. Error while reading product<br>
                2. Error while reading product<br>
                nkirov@cpp %</font></tt><br>
          </td>
        </tr>
      </tbody>
    </table>
    <font size="+1"><tt><br>
      </tt></font>
    <hr size="2" width="100%"> <b><br>
      *** Спецификации на изключенията</b><br>
    <br>
    При дефинирането на функция, можем да определим кои изключения може
    да изхвърля (или да пропуска) функцията. <br>
    <i>Например:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>     <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> (UnexpectedEndOfFile, bad_alloc)</font></pre>
    означава, че само зададените две изключения са позволени на тази
    функция. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">  throw</span> ()</font></pre>
    задава забрана за всички изключения, а липса на <span style="color:
      rgb(51, 51, 255); font-family: monospace; font-size: large;
      font-style: normal; font-variant: normal; font-weight: bold;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">throw</span>
    означава разрешение за изключения от всеки тип.<br>
    <i><br>
      Пример: </i><a href="../sources/exept.cpp"><font size="+1"><tt>exept.cpp</tt></font></a><br>
    <br>
    <table width="100%" cellspacing="2" cellpadding="2" border="1">
      <tbody>
        <tr>
          <td valign="top"><tt><font size="+1">ff1<br>
                f<br>
                2. 22</font></tt><br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    Stroustrup's example: <a href="../sources/ch17/strous.cpp"> </a><br>
    <br>
    <a href="../sources/ch17/strous.cpp"><font size="+1"><tt>//
          strous.cpp</tt></font>.</a><br>
    <font size="+1"><tt>#include &lt;iostream&gt;</tt><tt><br>
      </tt><tt>using namespace std;</tt><tt><br>
      </tt><tt><br>
      </tt><tt>class Vector {</tt><tt><br>
      </tt><tt>public:</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; enum { max = 32000 };</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; class Range {</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; public:</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int index;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Range(int i): index(i){}</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; };</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; class Size {};</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; Vector(int);</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; int &amp;operator[](int);</tt><tt><br>
      </tt><tt>private:</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; int *p;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp; int sz;</tt><tt><br>
      </tt><tt>};</tt><tt><br>
      </tt><tt><br>
      </tt><tt>void f();</tt><tt><br>
      </tt><tt><br>
      </tt><tt>int main()</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; "begin main()\n";</tt><tt><br>
      </tt><tt>&nbsp; f();</tt><tt><br>
      </tt><tt>&nbsp; cout &lt;&lt; "end main()\n";</tt><tt><br>
      </tt><tt>&nbsp; return 0;</tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>Vector::Vector(int s)</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; "Vector::Vector\n";</tt><tt><br>
      </tt><tt>&nbsp; if (s &lt; 0 || s &gt; max) throw Size();</tt><tt><br>
      </tt><tt>&nbsp; sz = s;</tt><tt><br>
      </tt><tt>&nbsp; p = new int[sz];</tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>int&amp; Vector::operator[](int i)</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; "Vector::operator[](int)\n";</tt><tt><br>
      </tt><tt>&nbsp; if (i &gt; 0 &amp;&amp; i &lt; sz) return p[i];</tt><tt><br>
      </tt><tt>&nbsp; throw Range(i); }</tt><tt><br>
      </tt><tt><br>
      </tt><tt>void use_vectors()</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; "use_vectors()\n";</tt><tt><br>
      </tt><tt>&nbsp; Vector v(-10);</tt><tt><br>
      </tt><tt>&nbsp; for (int i = 9; i &lt; 12; i++)</tt><tt><br>
      </tt><tt>&nbsp; { v[i] = i*i;</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; cout &lt;&lt; v[i] &lt;&lt; " ";</tt><tt><br>
      </tt><tt>&nbsp; }</tt><tt><br>
      </tt><tt>&nbsp; Vector vbad(-10);</tt><tt><br>
      </tt><tt>&nbsp; cout &lt;&lt; "BAD\n";</tt><tt><br>
      </tt><tt>}</tt><tt><br>
      </tt><tt><br>
      </tt><tt>void f()</tt><tt><br>
      </tt><tt>{ cout &lt;&lt; "begin f()\n";</tt><tt><br>
      </tt><tt>&nbsp; try</tt><tt><br>
      </tt><tt>&nbsp; { use_vectors(); </tt><tt><br>
      </tt><tt>&nbsp; }</tt><tt><br>
      </tt><tt>&nbsp; catch (Vector::Range r)</tt><tt><br>
      </tt><tt>&nbsp; { cout &lt;&lt; "Index " &lt;&lt; r.index &lt;&lt;
        " out of range!\n";</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; exit(99);</tt><tt><br>
      </tt><tt>&nbsp; }</tt><tt><br>
      </tt><tt>&nbsp; catch (Vector::Size)</tt><tt><br>
      </tt><tt>&nbsp; { cout &lt;&lt; "ERROR in the constructor
        Vector::Size\n";</tt><tt><br>
      </tt><tt>&nbsp;&nbsp;&nbsp; exit(99);</tt><tt><br>
      </tt><tt>&nbsp; }</tt><tt><br>
      </tt><tt>&nbsp; cout &lt;&lt; "end f()\n";</tt><tt><br>
      </tt><tt>}<br>
        <br>
      </tt></font>
    <table width="100%" cellspacing="2" cellpadding="2" border="1">
      <tbody>
        <tr>
          <td valign="top"><font size="+1"><tt>nkirov@cpp % c++
                strous.cpp</tt><tt><br>
              </tt><tt>nkirov@cpp % ./a.out</tt><tt><br>
              </tt><tt>begin main()</tt><tt><br>
              </tt><tt>begin f()</tt><tt><br>
              </tt><tt>use_vectors()</tt><tt><br>
              </tt><tt>Vector::Vector</tt><tt><br>
              </tt><tt>ERROR in the constructor Vector::Size</tt><tt><br>
              </tt><tt>nkirov@cpp %</tt></font><br>
          </td>
        </tr>
      </tbody>
    </table>
    <br>
    <a href="../sources/ch17/strous.cpp">
      <hr size="2" width="100%"> </a>
  </body>
</html>
