<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="Author" content="Nikolay Kirov">
    <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U)
      [Netscape]">
    <title>l07</title>
  </head>
  <body>
    <center>
      <h3> <b><font size="+1"><font size="+1">7</font>. Потоци I<br>
          </font></b>
</h3>
    </center>
    <img alt="" src="../b5.gif" height="18" width="20"><span style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; display: inline !important; float:
      none;">Пренасочване на входния и изходния потоци.<span class="Apple-converted-space"> </span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px;">
    <b style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><tt><font color="#006600">    C:\my\&gt;myprog &lt;
          a_cin.txt</font></tt></b><span style="color: rgb(0, 0, 0);
      font-family: 'Times New Roman'; font-size: medium; font-style:
      normal; font-variant: normal; font-weight: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: start;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; display: inline !important; float:
      none;"><span class="Apple-converted-space"> </span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px;">
    <span style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; display: inline !important; float:
      none;">    Вместо от клавиатурата, операционната
      система пренасочва входа от текстов файл, в случая това е файла<span class="Apple-converted-space"> </span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><tt><font color="#000000">a_cin.txt.</font></tt></b><span style="color:
      rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium;
      font-style: normal; font-variant: normal; font-weight: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      display: inline !important; float: none;">По този начин програмата
      за намиране на броя на думите може намери броя на думите в текстов
      файл (едно по-смислено приложение на тази програма).<span class="Apple-converted-space"> </span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px;">
    <b style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><tt><font color="#006600">    C:\my\&gt;myprog &gt;
          a_cout.txt</font></tt></b><span style="color: rgb(0, 0, 0);
      font-family: 'Times New Roman'; font-size: medium; font-style:
      normal; font-variant: normal; font-weight: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: start;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; display: inline !important; float:
      none;"><span class="Apple-converted-space"> </span></span><br style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px;">
    <span style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; display: inline !important; float:
      none;">    Вместо на екрана, операционната система
      пренасочва изхода на текстов файл, в случая това е файла<span class="Apple-converted-space"> </span></span><b style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><tt><font color="#009900">a_cout.txt.</font></tt></b><span style="color:
      rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: medium;
      font-style: normal; font-variant: normal; font-weight: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: start; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      display: inline !important; float: none;"><span class="Apple-converted-space"> </span></span><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><tt><b><font color="#000080">// <a href="../../NETB101/sources/ch7/words.cpp">words.cpp</a><br>#include</font></b> <font color="#FF0000">&lt;iostream&gt;
</font><b><font color="#000080">#include</font></b> <font color="#FF0000">&lt;string&gt;
</font><b><font color="#0000FF">using</font></b> <b><font color="#0000FF">namespace</font></b> std<font color="#990000">;

</font><font color="#009900">int</font> <b><font color="#000000">main</font></b><font color="#990000">()
</font><font color="#FF0000">{</font>  <font color="#009900">int</font> count <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;
</font>   string word<font color="#990000">;
</font>   <b><font color="#0000FF">while</font></b> <font color="#990000">(</font>cin <font color="#990000">&gt;&gt;</font> word<font color="#990000">)</font> count<font color="#990000">++;

</font>   cout <font color="#990000">&lt;&lt;</font> count <font color="#990000">&lt;&lt;</font> <font color="#FF0000">" words.\n"</font><font color="#990000">;
</font>   <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;<br>}</font><br></tt></pre>
    Четене на редове<font color="#990000">:<br>
      <pre><b>// <a href="../../NETB101/sources/ch7/lines.cpp">lines.cpp</a><br>#include &lt;iostream&gt;<br>#include &lt;string&gt;<br>using namespace std;<br><br>int main()<br>{  int count = 0;<br>   string lines;<br>   while (getline(cin, lines)) count++;<br>   cout &lt;&lt; count &lt;&lt; " lines.\n";<br>   return 0;<br>}</b></pre>
    </font>Четене на символи (букви, цифри и специални символи)<font color="#990000">:<br>
    </font>
    <pre><font color="#990000"><b>// <a href="../../NETB101/sources/ch7/chars.cpp">chars.cpp</a><br>#include &lt;iostream&gt;<br>using namespace std;<br><br>int main()<br>{  int count = 0;<br>   char ch;<br>   while (cin.get(ch)) count++;<br>   cout &lt;&lt; count &lt;&lt; " chars.\n";<br>   return 0;<br>}<br></b></font></pre>
    <hr size="2" width="100%">
    <p><img alt="" src="../b5.gif" height="18" width="20"> Четене и
      запис в текстови файлове. <br>
      ** Досега за четене от и запис във файлове - чрез пренасочване на
      стандартните вход и/или изход със средствата на операционната
      система <br>
      ** В заглавния файл <b><tt><font color="#000000">fstream</font></tt></b>
      са дефинирани обекти, функции и операции за работа с файлове. <br>
      А) Четене от файл. <br>
      * дефиниране на файлова променлива за четене - обект от класа <b><tt><font color="#006600">ifstream:</font></tt></b> <br>
      <b><tt><font color="#006600">    ifstream inp_data;</font></tt></b>
      <br>
      * отваряне на файл от текущата директория с име <b><tt><font color="#006600">input.dat:</font></tt></b> <br>
      <b><tt><font color="#006600">   
            inp_data.open("input.dat");</font></tt></b> <br>
      * четене от файл на: <br>
       - цели числа и числа с плаваща точка <br>
      <b><tt><font color="#006600">   int n;</font></tt></b> <br>
      <b><tt><font color="#006600">   double x;</font></tt></b>
      <br>
      <b><tt><font color="#006600">   inp_data &gt;&gt; n
            &gt;&gt; x;</font></tt></b> <br>
       - низове <br>
      <b><tt><font color="#006600">   string s;</font></tt></b>
      <br>
      <b><tt><font color="#006600">   inp_data &gt;&gt;
            s;        // чете до
            разделител</font></tt></b> <br>
      <b><tt><font color="#006600">   getline(inp_data, s); //
            чете цял ред</font></tt></b> <br>
       - символи <br>
      <b><tt><font color="#006600">   char ch;</font></tt></b>
      <br>
      <b><tt><font color="#006600">  
            inp_data.get(ch);    // чете един символ</font></tt></b>
      <br>
      <b><tt><font color="#006600">  
            inp_data.unget();    // връща последния
            прочетен символ в буфера</font></tt></b> <br>
      * затваряне на файл <br>
      <b><tt><font color="#006600">   inp_data.close();</font></tt></b>
    </p>
    <p>    Пример на цяла програма. <br>
      <b><tt><font color="#000099">// readf.cpp</font></tt></b> <br>
      <b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">#include
            &lt;fstream&gt;            
/*











            включване на заглавен файл */</font></tt></b> <br>
      <b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">using namespace std;</font></tt></b> </p>
    <p> <b><tt><font color="#000099">int main()</font></tt></b> <br>
      <b><tt><font color="#000099">{  ifstream in_data; /*
            дефиниране на файлова променлива за четене */</font></tt></b>
      <br>
      <b><tt><font color="#000099">  
            in_data.open("readf.txt");  /* отваряне на файла
            readf.txt */</font></tt></b> </p>
    <p><b><tt><font color="#000099">   string s1, s2;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   getline(in_data,
            s1);       /* четене на ред */</font></tt></b>
      <br>
      <b><tt><font color="#000099">   in_data &gt;&gt;
            s2;             
/*











            четене на дума */</font></tt></b> </p>
    <p><b><tt><font color="#000099">   int n;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   double x;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   in_data &gt;&gt; n
            &gt;&gt;
            x;          /*
            четене на числови данни */</font></tt></b> </p>
    <p><b><tt><font color="#000099">   char ch;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   while (!in_data.eof())</font></tt></b>
      <br>
      <b><tt><font color="#000099">     
            in_data.get(ch);        
            /* четене на символ */</font></tt></b> </p>
    <p><b><tt><font color="#000099">  
            in_data.close();           
/*











            затваряне на файла */</font></tt></b> <br>
      <b><tt><font color="#000099">   cout &lt;&lt; s1
            &lt;&lt; endl &lt;&lt; s2 &lt;&lt; " "</font></tt></b> <br>
      <b><tt><font color="#000099">       
&lt;&lt;











            n &lt;&lt; " " &lt;&lt; x &lt;&lt; " " &lt;&lt; ch &lt;&lt;
            endl;</font></tt></b> <br>
      <b><tt><font color="#000099">   return 0;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> <br>
      <font color="#000000">Файл </font><b><tt><font color="#000099">readf.txt:</font></tt></b>
      </p>
<table bgcolor="#CCCCCC" border="" cellpadding="4">
        <tbody>
          <tr>
            <td>
<b><tt><font color="#000000">many happy words</font></tt></b>
              <br>
              <b><tt><font color="#000000">one_word  123 
                    9.98  N</font></tt></b>
</td>
          </tr>
        </tbody>
      </table>
      <table border="" cellpadding="4" width="100%">
        <tbody>
          <tr>
            <td>
<b><tt><font color="#993300">many happy words</font></tt></b>
              <br>
              <b><tt><font color="#993300">one_word  123 
                    9.98  N</font></tt></b>
</td>
          </tr>
        </tbody>
      </table>
    
    <p><tt>//<b> </b><b><a href="../../NETB151/sources/ch12/readfile.cpp">readfile.cpp</a></b><b><br>
        </b><b>#include &lt;string&gt;</b></tt><b><tt><br>
        </tt></b><b><tt>#include &lt;iostream&gt;</tt></b><b><tt><br>
        </tt></b><b><tt>#include &lt;fstream&gt;</tt></b><b><tt><br>
        </tt></b><b><tt>using namespace std;</tt></b><b><tt><br>
        </tt></b><b><tt><br>
        </tt></b><b><tt>int main()</tt></b><b><tt><br>
        </tt></b><b><tt>{  cout &lt;&lt; "Enter the file name: ";</tt></b><b><tt><br>
        </tt></b><b><tt>   string fname;</tt></b><b><tt><br>
        </tt></b><b><tt>   cin &gt;&gt; fname;</tt></b><b><tt><br>
        </tt></b><b><tt>   </tt></b><b><tt><br>
        </tt></b><b><tt>   ifstream infile;</tt></b><b><tt><br>
        </tt></b><b><tt>   infile.open(fname.c_str());</tt></b><b><tt><br>
        </tt></b><b><tt>   if (infile.fail())</tt></b><b><tt><br>
        </tt></b><b><tt>   {  cout &lt;&lt; "ERROR";</tt></b><b><tt><br>
        </tt></b><b><tt>      return
          1;           
        </tt></b><b><tt><br>
        </tt></b><b><tt>   }</tt></b><b><tt><br>
        </tt></b><b><tt>   </tt></b><b><tt><br>
        </tt></b><b><tt>   int sum = 0;</tt></b><b><tt><br>
        </tt></b><b><tt>   while (!infile.eof())</tt></b><b><tt><br>
        </tt></b><b><tt>   {  char ch;</tt></b><b><tt><br>
        </tt></b><b><tt>      infile.get(ch);</tt></b><b><tt><br>
        </tt></b><b><tt>      if ('0' &lt;= ch
          &amp;&amp; ch &lt;= '9') /* it was a digit */</tt></b><b><tt><br>
        </tt></b><b><tt>      { 
          infile.unget(); /* oops - didn't want to read it */</tt></b><b><tt><br>
        </tt></b><b><tt>        
          int n;</tt></b><b><tt><br>
        </tt></b><b><tt>        
          infile &gt;&gt; n; /* read integer starting with ch */</tt></b><b><tt><br>
        </tt></b><b><tt>        
          sum += n;</tt></b><b><tt><br>
        </tt></b><b><tt>      }</tt></b><b><tt><br>
        </tt></b><b><tt>      else cout
          &lt;&lt; ch; </tt></b><b><tt><br>
        </tt></b><b><tt>   }</tt></b><b><tt><br>
        </tt></b><b><tt>   infile.close();</tt></b><b><tt><br>
        </tt></b><b><tt>   cout &lt;&lt; "The sum is "
          &lt;&lt; sum &lt;&lt; endl;</tt></b><b><tt><br>
        </tt></b><b><tt>   return 0;</tt></b><b><tt><br>
        </tt></b><b><tt>}</tt></b><br>
      <br>
      Б) Писане във файл. <br>
      * дефиниране на файлова променлива за писане - обект от класа <b><tt><font color="#006600">ofstream:</font></tt></b> <br>
      <b><tt><font color="#006600">   ofstream out_data;</font></tt></b>
      <br>
      * отваряне на файл <br>
      <b><tt><font color="#006600">  
            out_data.open("output.dat");</font></tt></b> <br>
      * писане във  файл с: <br>
       - изходен поток <br>
      <b><tt><font color="#006600">   int n = 2;</font></tt></b>
      <br>
      <b><tt><font color="#006600">   double x = 1.5;</font></tt></b>
      <br>
      <b><tt><font color="#006600">   string s = " Hello";</font></tt></b>
      <br>
      <b><tt><font color="#006600">   out_data &lt;&lt; n
            &lt;&lt; "  " &lt;&lt; x &lt;&lt; s;</font></tt></b> <br>
       - член-функция <br>
      <b><tt><font color="#006600">   char ch = 'A';</font></tt></b>
      <br>
      <b><tt><font color="#006600">   out_data.put(ch);</font></tt></b>
      <br>
      * затваряне на файл <br>
      <b><tt><font color="#006600">   out_data.close();</font></tt></b>
    </p>
    <p>    Пример на цяла програма. <br>
      <b><tt><font color="#000099">// writef.cpp</font></tt></b> <br>
      <b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">#include
            &lt;fstream&gt;            
/*











            включване на заглавен файл */</font></tt></b> <br>
      <b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">using namespace std;</font></tt></b>
      <br>
      <b><tt><font color="#000099">int main()</font></tt></b> <br>
      <b><tt><font color="#000099">{  ofstream out_data; /*
            дефиниране на файлова променлива за писане */</font></tt></b>
      <br>
      <b><tt><font color="#000099">  
            out_data.open("writef.txt");  /* отваряне на файла
            writef.txt */</font></tt></b> </p>
    <p><b><tt><font color="#000099">   string s = "Hello";</font></tt></b>
      <br>
      <b><tt><font color="#000099">   out_data &lt;&lt; s
            &lt;&lt; endl; /* писане на низ */</font></tt></b> <br>
      <b><tt><font color="#000099">   int n = 5;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   double x = 5.5;</font></tt></b>
      <br>
      <b><tt><font color="#000099">   out_data &lt;&lt; n
            &lt;&lt; " " &lt;&lt; x &lt;&lt; " "; /* писане на числови
            данни */</font></tt></b> <br>
      <b><tt><font color="#000099">   char ch = 'T';</font></tt></b>
      <br>
      <b><tt><font color="#000099">   out_data.put(ch); /*
            писане на символ */</font></tt></b> </p>
    <p><b><tt><font color="#000099">  
            out_data.close();           
/*











            затваряне на файла */</font></tt></b> <br>
      <b><tt><font color="#000099">   return 0;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> <br>
      <font color="#000000">Файл <b><tt>writef.txt:</tt></b></font>
      </p>
<table bgcolor="#CCCCCC" border="" cellpadding="4">
        <tbody>
          <tr>
            <td>
<b><tt><font color="#000000">Hello</font></tt></b> <br>
              <b><tt><font color="#000000">5 5.5 T</font></tt></b>
</td>
          </tr>
        </tbody>
      </table>
    
    <pre><b>// </b><b><a href="../../NETB151/sources/ch12/readwritefiles.cpp">readwritefiles.cpp</a></b><b><br></b><b>#include &lt;string&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
using namespace std;

int main()
{  cout &lt;&lt; "Enter the input file name: ";
   string finame;
   cin &gt;&gt; finame;
   
   ifstream infile;
   infile.open(finame.c_str());
   if (infile.fail())
   {  cout &lt;&lt; "Error opening " &lt;&lt; finame &lt;&lt; endl;
      return 1;            
   }
   
   cout &lt;&lt; "Enter the output file name: ";
   string foname;
   cin &gt;&gt; foname;
   
   ofstream outfile;
   outfile.open(foname.c_str());
   if (outfile.fail())
   {  cout &lt;&lt; "Error opening " &lt;&lt; foname &lt;&lt; endl;;
      return 1;            
   }
   
   while (!infile.eof())
   {  char ch;
      infile.get(ch);
      if ('0' &lt;= ch &amp;&amp; ch &lt;= '9') /* it was a digit */
      {  infile.unget(); /* oops - didn't want to read it */
         int n;
         infile &gt;&gt; n; /* read integer starting with ch */
         outfile &lt;&lt; n &lt;&lt; endl;
      }
      else cout &lt;&lt; ch; 
   }
   infile.close();
   outfile.close();
   return 0;
}<br></b></pre>
    <p>Потоковата библиотека на С++ се състои от няколко класове,
      свързани в следната йерархия:</p>
    <p><img alt="" src="../../NETB151/slides/ch12/images/stream_hierarchy.png" height="337" width="715"><br>
    </p>
    <p>* Обектите <font size="+1"><tt>cin</tt></font> и <font size="+1"><tt>cout </tt></font>са от класове, които са системно
      зависими и нямат стандартни имена, но са производни класове
      съответно на  <font size="+1"><tt>istream</tt></font> и <font size="+1"><tt>ostream</tt></font>. Затова можем да дефинираме:<br>
    </p>
    <p><font size="+1"> </font></p>
    <pre><font size="+1">double read_data(istream&amp; in);</font></pre>
    <font size="+1"> </font>
    <p>и след това да извикаме функцията с параметри от различни
      производни на <font size="+1"><tt>istream</tt></font> класове: .<br>
    </p>
    <p><font size="+1"> </font></p>
    <pre><font size="+1">max = read_data(infile);<br>max = read_data(cin);</font></pre>
    <font size="+1"> </font>
    <p>Пример:<br>
    </p>
    <pre><b>// </b><b><a href="../../NETB151/sources/ch12/maxval2.cpp">maxval2.cpp</a></b><b><br></b><b>#include &lt;string&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
using namespace std;

/**
   Reads numbers from a file and finds the maximum value
   @param in the input stream to read from
   @return the maximum value or 0 if the file has no numbers
*/            
double read_data(istream&amp; in)
{  double highest;
   double next;
   if (in &gt;&gt; next) highest = next;
   else return 0;

   while (in &gt;&gt; next)
      if (next &gt; highest) highest = next;
   
   return highest;
}

int main()
{  double max;

   string input;
   cout &lt;&lt; "Do you want to read from a file? (y/n) ";
   cin &gt;&gt; input;

   if (input == "y")
   {  string filename;
      cout &lt;&lt; "Please enter the data file name: ";
      cin &gt;&gt; filename;

      ifstream infile;
      infile.open(filename.c_str());

      if (infile.fail()) 
      {  cout &lt;&lt; "Error opening " &lt;&lt; filename &lt;&lt; "\n";
         return 1;
      }

      max = read_data(infile);
      infile.close();
   }
   else max = read_data(cin);

   cout &lt;&lt; "The maximum value is " &lt;&lt; max &lt;&lt; "\n";
   return 0;
}</b></pre>
    <hr width="100%"> <br>
    <img alt="" src="../b5.gif" height="18" width="20"> Низови
    (текстови) потоци. <br>
        В езика С++ има възможност да се чете/пише от/в
    низове вместо да се използват стандартни устройства или файлове. В
    заглавния файл <b><tt><font color="#000000">sstream</font></tt></b>
    са дефинирани обекти, функции и операции за работа с текстови
    потоци. <br>
    * Входен поток - с обект от клас <b><tt><font color="#006600">istringstream.</font></tt></b>
    <br>
    <b><tt><font color="#006600">string input = "January 23, 1881";</font></tt></b>
    <br>
    <b><tt><font color="#006600">istringstream instr(input);</font></tt></b>
    <br>
    <b><tt><font color="#006600">string month;</font></tt></b> <br>
    <b><tt><font color="#006600">int day;</font></tt></b> <br>
    <b><tt><font color="#006600">string comma;</font></tt></b> <br>
    <b><tt><font color="#006600">int year;</font></tt></b> <br>
    <b><tt><font color="#006600">instr &gt;&gt; month &gt;&gt; day
          &gt;&gt; comma &gt;&gt; year;</font></tt></b> <br>
    * Изходен поток - с обект от клас <b><tt><font color="#006600">ostringstream.</font></tt></b>
    <br>
    <b><tt><font color="#006600">ostringstream outstr;</font></tt></b> <br>
    <b><tt><font color="#006600">outstr &lt;&lt; setprecision(8)
          &lt;&lt; sqrt(2);</font></tt></b> <br>
    <b><tt><font color="#006600">string output = outstr.str();</font></tt></b>
    <p><b>Пример:</b> Преобразуване на момент от време в низ. В САЩ има
      два формата за записване на време с разлика в часовете: <i><br>
        - am/pm</i> - денонощието започва с 12 am следват 1-11 am, 12 pm
      и 1-11 pm.<br>
      - <i>military </i>- часовете са от 00 до 23.<br>
      <b><tt><font color="#000099">// <a href="../../NETB151/sources/ch12/readtime.cpp">readtime.cpp</a></font></tt></b><a href="../../NETB151/sources/ch12/readtime.cpp"> </a><br>
      <b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">#include &lt;sstream&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">using namespace std;</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">string int_to_string(int n)</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ ostringstream outstr;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  outstr &lt;&lt; n;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  return outstr.str();</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">void read_time(int &amp;hours, int
            &amp;minutes)</font></tt></b> <br>
      <b><tt><font color="#000099">{ string line;</font></tt></b> <br>
      <b><tt><font color="#000099">  getline(cin, line);</font></tt></b>
      <br>
      <b><tt><font color="#000099">  istringstream instr(line);</font></tt></b>
      <br>
      <b><tt><font color="#000099">  instr &gt;&gt; hours;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  minutes = 0;</font></tt></b> <br>
      <b><tt><font color="#000099">  char ch;</font></tt></b> <br>
      <b><tt><font color="#000099">  instr.get(ch);</font></tt></b>
      <br>
      <b><tt><font color="#000099">  if (ch == ':') instr &gt;&gt;
            minutes;</font></tt></b> <br>
      <b><tt><font color="#000099"> 
            else          
            instr.unget();</font></tt></b> </p>
    <p><b><tt><font color="#000099">  string suffix;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  instr &gt;&gt; suffix;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  if (suffix == "pm") hours +=
            12;</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">string time_to_string(int hours, int
            minutes, bool am_pm)</font></tt></b> <br>
      <b><tt><font color="#000099">{ string suffix;</font></tt></b> <br>
      <b><tt><font color="#000099">  if (am_pm)</font></tt></b> <br>
      <b><tt><font color="#000099">  { if (hours &lt; 12) suffix =
            "am";</font></tt></b> <br>
      <b><tt><font color="#000099">    else { suffix =
            "pm"; hours -= 12; }</font></tt></b> <br>
      <b><tt><font color="#000099">    if (hours == 0)
            hours = 12;</font></tt></b> <br>
      <b><tt><font color="#000099">  }</font></tt></b> <br>
      <b><tt><font color="#000099">  string result =
            int_to_string(hours) + ":";</font></tt></b> <br>
      <b><tt><font color="#000099">  if (minutes &lt; 10) result =
            result + "0";</font></tt></b> <br>
      <b><tt><font color="#000099">  result = result +
            int_to_string(minutes);</font></tt></b> <br>
      <b><tt><font color="#000099">  if (am_pm) result = result + "
            " + suffix;</font></tt></b> <br>
      <b><tt><font color="#000099">  return result;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">int main()</font></tt></b> <br>
      <b><tt><font color="#000099">{ cout &lt;&lt; "Please enter the
            time: ";</font></tt></b> <br>
      <b><tt><font color="#000099">  int hours, minutes;</font></tt></b>
      <br>
      <b><tt><font color="#000099">  read_time(hours, minutes);</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">  cout &lt;&lt; "Using
            am/pm:   " &lt;&lt; time_to_string(hours, minutes,
            true) &lt;&lt; "\n";</font></tt></b> <br>
      <b><tt><font color="#000099">  cout &lt;&lt; "Military time:
            " &lt;&lt; time_to_string(hours, minutes, false) &lt;&lt;
            "\n";</font></tt></b> <br>
      <b><tt><font color="#000099">  return 0;</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b>
      </p>
<table border="" cellpadding="4" width="100%">
        <tbody>
          <tr>
            <td>
<b><tt><font color="#993300">Please enter the time:
                    10:20 pm</font></tt></b> <br>
              <b><tt><font color="#993300">Using am/pm:  
                    10:20 pm</font></tt></b> <br>
              <b><tt><font color="#993300">Military time: 22:20</font></tt></b>
</td>
          </tr>
        </tbody>
      </table>
    
    В) Четене и писане във файл - пряк (произволен) достъп.<br>
    Последователен достъп означава, че можем да четем/пишем от/във файл
    само последователно - елемент след елемент, байт след байт.<br>
    Сега бихме искали да можем да четем и пишем на всяко място във
    файла, което се нарича пряк или произволен достъп.<br>
    <img alt="" src="../../NETB151/slides/ch12/images/random_access.png" height="242" width="733"><br>
    За тази цел за всеки файл са дефинирани две срециални позиции: <br>
    <ul>
      <li>get - позиция за четене,</li>
      <li>put - позиция за писане.</li>
    </ul>
    <div align="center"><img alt="" src="../../NETB151/slides/ch12/images/get_put.png" height="295" width="444"></div>
    <p>Можем да преместваме тези позиции относно три константи,
      дефинитани в класа <tt>ios</tt> (базов клас за потоковите класове
      <tt>istream</tt> и <tt>ostream</tt>):<br>
    </p>
    <ul>
      <li>
<tt>ios::beg</tt> - начало на файла;</li>
      <li>
<tt>ios::end</tt> - край на файла;</li>
      <li>
<tt>ios::cur</tt> - текуща позиция</li>
    </ul>
    <p></p>
    <p>с процедурите <tt>seekg</tt> и <tt>seekp</tt>. Например:<br>
      <font size="+1">
        <pre>fs.seekg(n, ios::beg);<br>fs.seekp(n, ios::beg);</pre>
      </font>преместват позицията с <tt>n</tt> байта от началото на
      файла <tt>fs</tt>. Текущата позиция се получава така:<br>
      <font size="+1">
        <pre>n = fs.tellg();<br>n = fs.tellp();</pre>
      </font>Тези функции връщат тип <tt>long</tt>. Дължината на файл
      можем да получим по следния начин:<br>
      <font size="+1">
        <pre>fs.seekg(0, ios::end);<br>long file_length = fs.tellg();</pre>
      </font>Когати използваме пряк достъп, трябва да внимаваме за
      формата на данните във файла. Например нека имаме файл с данни за
      служители:<br>
      <img alt="" src="../../NETB151/slides/ch12/images/record1.png" height="51" width="890"><br>
    </p>
    <p>и искаме да увеличим заплатата на Хари с 5.5%. Получаваме
      36397.50 и ако запишем новата заплата във файла, получаваме:<br>
      <img alt="" src="../../NETB151/slides/ch12/images/record2.png" height="51" width="890"><br>
      което поврежда следващия запис. Затова се използват записи
      (логически единици от данни) с фиксирана дължина.<br>
      <img alt="" src="../../NETB151/slides/ch12/images/fixed-record.png" height="76" width="1062"><br>
    </p>
    <p><br>
      * дефиниране на файлова променлива за четене и писане - обект от
      класа <b><tt><font color="#006600">fstream:</font></tt></b> <br>
      <b><tt><font color="#006600">   fstream io_data;</font></tt></b>
      <br>
      * отваряне на файл, четене и писане - както са описани по-горе. </p>
    <p>* Пример: Програма за четене и писане във файла <a href="../../NETB151/sources/ch12/employee.dat"><big><b><tt>employee.dat</tt></b></big></a><b><tt><font color="#000099"><br>
          </font></tt></b></p>
    <pre><tt>// <b><a href="../../NETB151/sources/ch12/database.cpp">database.cpp</a></b><br>01: <b><font color="#000080">#include</font></b> <font color="#ff0000">&lt;iostream&gt;</font>
02: <b><font color="#000080">#include</font></b> <font color="#ff0000">&lt;iomanip&gt;</font>
03: <b><font color="#000080">#include</font></b> <font color="#ff0000">&lt;fstream&gt;</font>
04: <b><font color="#000080">#include</font></b> <font color="#ff0000">&lt;sstream&gt;</font>
06: <b><font color="#0000ff">using</font></b> <b><font color="#0000ff">namespace</font></b> std<font color="#990000">;</font>
07: 
08: <b><font color="#000080">#include</font></b> <font color="#ff0000">"ccc_empl.cpp"</font>
09: 
10: <b><font color="#0000ff">const</font></b> <font color="#009900">int</font> NEWLINE_LENGTH <font color="#990000">=</font> <font color="#993399">2</font><font color="#990000">;</font> <i><font color="#9a1900">/* 2 for Windows or 1 on Unix */</font></i>
11: <b><font color="#0000ff">const</font></b> <font color="#009900">int</font> RECORD_SIZE <font color="#990000">=</font> <font color="#993399">30</font> <font color="#990000">+</font> <font color="#993399">10</font> <font color="#990000">+</font> NEWLINE_LENGTH<font color="#990000">;</font>
13: <i><font color="#9a1900">/** </font></i>
14: <i><font color="#9a1900">   Converts a string to a floating-point value, e.g. </font></i>
15: <i><font color="#9a1900">   "3.14" -&gt; 3.14.</font></i>
16: <i><font color="#9a1900">   @param s a string representing a floating-point value</font></i>
17: <i><font color="#9a1900">   @return the equivalent floating-point value</font></i>
18: <i><font color="#9a1900">*/</font></i>   <br>19: <font color="#009900">double</font> <b><font color="#000000">string_to_double</font></b><font color="#990000">(</font>string s<font color="#990000">)</font>
20: <font color="#ff0000">{</font>  istringstream <b><font color="#000000">instr</font></b><font color="#990000">(</font>s<font color="#990000">)</font><font color="#990000">;</font>
22:    <font color="#009900">double</font> x<font color="#990000">;</font>
23:    instr <font color="#990000">&gt;</font><font color="#990000">&gt;</font> x<font color="#990000">;</font>
24:    <b><font color="#0000ff">return</font></b> x<font color="#990000">;</font>
25: <font color="#ff0000">}</font>
27: <i><font color="#9a1900">/** </font></i>
28: <i><font color="#9a1900">   Raises an employee salary.</font></i>
29: <i><font color="#9a1900">   @param e employee receiving raise</font></i>
30: <i><font color="#9a1900">   @param percent the percentage of the raise</font></i>
31: <i><font color="#9a1900">*/</font></i>
32: <font color="#009900">void</font> <b><font color="#000000">raise_salary</font></b><font color="#990000">(</font>Employee<font color="#990000">&amp;</font> e<font color="#990000">,</font> <font color="#009900">double</font> percent<font color="#990000">)</font>
33: <font color="#ff0000">{</font>  <font color="#009900">double</font> new_salary <font color="#990000">=</font> e<font color="#990000">.</font><b><font color="#000000">get_salary</font></b><font color="#990000">(</font><font color="#990000">)</font> <font color="#990000">*</font> <font color="#990000">(</font><font color="#993399">1</font> <font color="#990000">+</font> percent <font color="#990000">/</font> <font color="#993399">100</font><font color="#990000">)</font><font color="#990000">;</font>
35:    e<font color="#990000">.</font><b><font color="#000000">set_salary</font></b><font color="#990000">(</font>new_salary<font color="#990000">)</font><font color="#990000">;</font>
36: <font color="#ff0000">}</font>
38: <i><font color="#9a1900">/**</font></i>
39: <i><font color="#9a1900">   Reads an employee record from a file.</font></i>
40: <i><font color="#9a1900">   @param e filled with the employee</font></i>
41: <i><font color="#9a1900">   @param in the stream to read from</font></i>
42: <i><font color="#9a1900">*/</font></i>
43: <font color="#009900">void</font> <b><font color="#000000">read_employee</font></b><font color="#990000">(</font>Employee<font color="#990000">&amp;</font> e<font color="#990000">,</font> istream<font color="#990000">&amp;</font> in<font color="#990000">)</font>
44: <font color="#ff0000">{</font>  string line<font color="#990000">;</font>
46:    <b><font color="#000000">getline</font></b><font color="#990000">(</font>in<font color="#990000">,</font> line<font color="#990000">)</font><font color="#990000">;</font>
47:    <b><font color="#0000ff">if</font></b> <font color="#990000">(</font>in<font color="#990000">.</font><b><font color="#000000">fail</font></b><font color="#990000">(</font><font color="#990000">)</font><font color="#990000">)</font> <b><font color="#0000ff">return</font></b><font color="#990000">;</font>
48:    string name <font color="#990000">=</font> line<font color="#990000">.</font><b><font color="#000000">substr</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> <font color="#993399">30</font><font color="#990000">)</font><font color="#990000">;</font>
49:    <font color="#009900">double</font> salary <font color="#990000">=</font> <b><font color="#000000">string_to_double</font></b><font color="#990000">(</font>line<font color="#990000">.</font><b><font color="#000000">substr</font></b><font color="#990000">(</font><font color="#993399">30</font><font color="#990000">,</font> <font color="#993399">10</font><font color="#990000">)</font><font color="#990000">)</font><font color="#990000">;</font>
50:    e <font color="#990000">=</font> <b><font color="#000000">Employee</font></b><font color="#990000">(</font>name<font color="#990000">,</font> salary<font color="#990000">)</font><font color="#990000">;</font>
51: <font color="#ff0000">}</font>
53: <i><font color="#9a1900">/**</font></i>
54: <i><font color="#9a1900">   Writes an employee record to a stream</font></i>
55: <i><font color="#9a1900">   @param e the employee record to write</font></i>
56: <i><font color="#9a1900">   @param out the stream to write to</font></i>
57: <i><font color="#9a1900">*/</font></i>
58: <font color="#009900">void</font> <b><font color="#000000">write_employee</font></b><font color="#990000">(</font>Employee e<font color="#990000">,</font> ostream<font color="#990000">&amp;</font> out<font color="#990000">)</font>
59: <font color="#ff0000">{</font> out <font color="#990000">&lt;</font><font color="#990000">&lt;</font> e<font color="#990000">.</font><b><font color="#000000">get_name</font></b><font color="#990000">(</font><font color="#990000">)</font>
61:       <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <b><font color="#000000">setw</font></b><font color="#990000">(</font><font color="#993399">10</font> <font color="#990000">+</font> <font color="#990000">(</font><font color="#993399">30</font> <font color="#990000">-</font> e<font color="#990000">.</font><b><font color="#000000">get_name</font></b><font color="#990000">(</font><font color="#990000">)</font><font color="#990000">.</font><b><font color="#000000">length</font></b><font color="#990000">(</font><font color="#990000">)</font><font color="#990000">)</font><font color="#990000">)</font>
62:       <font color="#990000">&lt;</font><font color="#990000">&lt;</font> fixed <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <b><font color="#000000">setprecision</font></b><font color="#990000">(</font><font color="#993399">2</font><font color="#990000">)</font>
63:       <font color="#990000">&lt;</font><font color="#990000">&lt;</font> e<font color="#990000">.</font><b><font color="#000000">get_salary</font></b><font color="#990000">(</font><font color="#990000">)</font> <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <font color="#ff0000">"\n"</font><font color="#990000">;</font>
65: }
67: <font color="#009900">int</font> <b><font color="#000000">main</font></b><font color="#990000">(</font><font color="#990000">)</font>
68: <font color="#ff0000">{</font>  cout <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <font color="#ff0000">"Please enter the data file name: "</font><font color="#990000">;</font>
70:    string filename<font color="#990000">;</font>
71:    cin <font color="#990000">&gt;</font><font color="#990000">&gt;</font> filename<font color="#990000">;</font>
72:    fstream fs<font color="#990000">;</font>
73:    fs<font color="#990000">.</font><b><font color="#000000">open</font></b><font color="#990000">(</font>filename<font color="#990000">.</font><b><font color="#000000">c_str</font></b><font color="#990000">(</font><font color="#990000">)</font><font color="#990000">)</font><font color="#990000">;</font>
74:    fs<font color="#990000">.</font><b><font color="#000000">seekg</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> ios<font color="#990000">:</font><font color="#990000">:</font>end<font color="#990000">)</font><font color="#990000">;</font> <i><font color="#9a1900">/* go to end of file */</font></i>
75:    <font color="#009900">int</font> nrecord <font color="#990000">=</font> fs<font color="#990000">.</font><b><font color="#000000">tellg</font></b><font color="#990000">(</font><font color="#990000">)</font> <font color="#990000">/</font> RECORD_SIZE<font color="#990000">;</font>
76: 
77:    cout <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <font color="#ff0000">"Please enter the record to update: (0 - "</font>
78:         <font color="#990000">&lt;</font><font color="#990000">&lt;</font> nrecord <font color="#990000">-</font> <font color="#993399">1</font> <font color="#990000">&lt;</font><font color="#990000">&lt;</font> <font color="#ff0000">") "</font><font color="#990000">;</font>
79:    <font color="#009900">int</font> pos<font color="#990000">;</font>
80:    cin <font color="#990000">&gt;</font><font color="#990000">&gt;</font> pos<font color="#990000">;</font>
81: 
82:    <b><font color="#0000ff">const</font></b> <font color="#009900">double</font> SALARY_CHANGE <font color="#990000">=</font> <font color="#993399">5.0</font><font color="#990000">;</font>
83: 
84:    Employee e<font color="#990000">;</font>
85:    fs<font color="#990000">.</font><b><font color="#000000">seekg</font></b><font color="#990000">(</font>pos <font color="#990000">*</font> RECORD_SIZE<font color="#990000">,</font> ios<font color="#990000">:</font><font color="#990000">:</font>beg<font color="#990000">)</font><font color="#990000">;</font>
86:    <b><font color="#000000">read_employee</font></b><font color="#990000">(</font>e<font color="#990000">,</font> fs<font color="#990000">)</font><font color="#990000">;</font>
87:    <b><font color="#000000">raise_salary</font></b><font color="#990000">(</font>e<font color="#990000">,</font> SALARY_CHANGE<font color="#990000">)</font><font color="#990000">;</font>
88:    fs<font color="#990000">.</font><b><font color="#000000">seekp</font></b><font color="#990000">(</font>pos <font color="#990000">*</font> RECORD_SIZE<font color="#990000">,</font> ios<font color="#990000">:</font><font color="#990000">:</font>beg<font color="#990000">)</font><font color="#990000">;</font>
89:    <b><font color="#000000">write_employee</font></b><font color="#990000">(</font>e<font color="#990000">,</font> fs<font color="#990000">)</font><font color="#990000">;</font>
90: 
91:    fs<font color="#990000">.</font><b><font color="#000000">close</font></b><font color="#990000">(</font><font color="#990000">)</font><font color="#990000">;</font>
92:    <b><font color="#0000ff">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
93: <font color="#ff0000">}</font></tt></pre>
    <p><br>
    </p>
    <hr width="100%">
  </body>
</html>
