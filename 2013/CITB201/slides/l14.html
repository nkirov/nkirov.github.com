<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;
      charset=windows-1251">
    <meta name="Author" content="Nikolay Kirov">
    <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U)
      [Netscape]">
    <title>l14</title>
  </head>
  <body>
    <center>
      <h3>14. Обработка на изключения</h3>
    </center>
    <img alt="" src="../b5.gif" height="18" width="20">&nbsp; Как да
    обработваме грешки когато използваме функция или клас?<br>
    Например:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b>cout &lt;&lt; future_value(1000, -100, -1);</b></pre>
    ** Не проверяваме условия за грешки и изпълняваме програмата,
    възможни са проблеми.
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b><br></pre>
    ** Проверяваме условията за грешка и не правим нищо в случай на
    грешка. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0) </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> 0;</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></pre>
    **Проверяваме условията за грешка, съобщаваме за грешката и спираме
    изпълнението на програмата. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  assert(p &gt;= 0 &amp;&amp; n &gt;= 0);</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></pre>
    Въникващи проблеми:<br>
    **Ако не се прави проверка за грешка, програмата ви може да бъда
    ненадеждна.<br>
    **Ако се върнете фалшива стойност, програмата продължава да използва
    стойността. Никой не знае каква е грешката, а само че нещо се е
    объркало.<br>
    **Много реални програми не могат да бъде спирани, като тези, които
    управляват ракета, самолет или медицинско устройство.<br>
    <br>
    <b>Изхвърляна на изключения</b><br>
    C++ има механизъм за уведомяване и обработка на изключения. Когато
    дадена функция открие грешка, тя може да сигнализира за състояние <br>
    (изхвърли изключение) към някоя друга част на програмата, чиято
    работа е да обработва грешки.&nbsp; <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>   {  </b><b>logic_error</b><b> <font color="#cc0000">description</font>("illegal future_value parameter");</b><b><br></b><b>      </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> description;</b><b><br></b><b>   }</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></pre>
    Може да не се задава име на обекта за обработка на изключения:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{ </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>    </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> </b><b>logic_error</b><b>("illegal future_value parameter");</b><b><br></b><b> </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><br>}</pre>
    Тук <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> е стандартен клас за изключения,
    който е дефиниран в заглавния файл&nbsp; <span style="color: rgb(0,
      0, 0); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">&lt;stdexcept&gt;</span>.<br>
    Ключовата дума показва, че изпълнението на функциятя спира
    незабавно, но управлението не се връща на извикващата функция, а<br>
    се търси частта от програмата за обработка на изключения.<br>
    <br>
    <b>Прихващане на изключения</b><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br>   // <i>code</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>{<br>   <i>// handler</i><br>}</pre>
    Ако някоя от функциите в блока <span style="color: rgb(51, 51,
      255); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: bold; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">try</span>
    изхвърли изключение <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">logic_error</span>,
    или вика друга функция, която изхвърля такова изключение,<br>
    блокът на <b><tt><span style="color: rgb(0, 0, 0); font-size:
          large; font-style: normal; font-variant: normal; font-weight:
          normal; letter-spacing: normal; line-height: normal;
          text-align: left; text-indent: 0px; text-transform: none;
          white-space: normal; word-spacing: 0px; background-color:
          rgb(255, 255, 255); display: inline ! important; float: none;">catch</span></tt></b>
    се изпълнява веднага.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">while</span> (more)<br>{  <span style="color: rgb(51, 51, 255); font-weight: bold;">try</span> <br>   {<br>      <i>// code</i><br>   }<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>   {  cout &lt;&lt; "A logic error has occurred "<br>           &lt;&lt; e.what() &lt;&lt; "\n" &lt;&lt; "Retry? (y/n)";<br>      string input;<br>      getline(cin, input);<br>      <span style="color: rgb(51, 51, 255);">if</span> (input == "n") more = false;<br>   }<br>}</font></pre>
    Член-функцията <b><span style="color: rgb(0, 0, 0); font-family:
        monospace; font-size: large; font-style: normal; font-variant:
        normal; font-weight: normal; letter-spacing: normal;
        line-height: normal; orphans: auto; text-align: left;
        text-indent: 0px; text-transform: none; white-space: normal;
        widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
        -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
        255); display: inline !important; float: none;">what</span></b>
    от класа <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: bold; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> връща низа, който е зададен като
    параметър при конструиране на обекта в оператора <span
      style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;"><tt>throw</tt><span class="Apple-converted-space"></span></span>.<br>
    <br>
    <table bgcolor="#00ffff" border="1" cellpadding="4">
      <tbody>
        <tr>
          <td bgcolor="#ffffff">
            <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{</font><i><font size="+1"><br></font></i><font size="+1"> <i>statements</i> <br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>1</sub> <i>variable_name</i><sub>1</sub>)<br>{<br> <i>statements</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>2</sub> <i>variable_name</i><sub>2</sub>)<br>{<br> <i>statements</i><br>}<br>...<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>n</sub> <i>variable_name</i><sub>n</sub>)<br>{<br> <i>statements</i><br>}</font></pre>
            <table border="0" cellpadding="4">
              <tbody>
                <tr>
                  <td valign="top"><font color="#00ffff" size="+1"><font
                        size="+1">Пример</font>:</font></td>
                  <td>
                    <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br> double fvalue = future_value(init, interest, years); <br> cout &lt;&lt; "The future value is " &lt;&lt; fvalue &lt;&lt; endl;<br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span>(logic_error&amp; e)<br>{<br> cout &lt;&lt; "Processing error " &lt;&lt; e.what() &lt;&lt; "\n";<br>}</font></pre>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
    <br class="Apple-interchange-newline">
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><code><font face="Courier New" size="3"><font color="#000000"><font color="#008000"> #//<a href="../../NETB151/sources/ch17/exception1.cpp">exception1.cpp</a><br><font size="3"> #</font>include </font>&lt;iostream&gt;<br> <font color="#008000">#include </font>&lt;stdexcept&gt;<br> </font></font></code><code><font><font><font><font face="Courier New" size="3"><font color="#000000"><font color="#008000">#include</font></font></font></font></font></font></code><code><font face="Courier New" size="3"><font color="#000000"> &lt;cmath&gt;<br> <b>using namespace </b>std;<br><br> <b>double </b>future_value(<b>double </b>initial_balance, <b>double </b>p, <b>int </b>n)<br>{  <b>if </b>(p &lt; <font color="#800080">0 </font>|| n &lt; <font color="#800080">0</font>)<br>   {  logic_error description(<font color="#ff0000">"illegal future_value parameter"</font>);<br>      <b>throw </b>description;<br>   }<br>   <b>return </b>initial_balance * pow(<font color="#800080">1 </font>+ p / <font color="#800080">100</font>, n);<br>}<br><br> <b>int </b>main()<br> {  <b>bool </b>more = <b>true</b>;<br>    <b>while </b>(more)<br>    {  <b>double </b>init, interest;<br>       <b>int </b>years;<br>       cout &lt;&lt; <font color="#ff0000">"Enter initial value, interest and years: "</font>;<br>       cin &gt;&gt; init &gt;&gt; interest &gt;&gt; years;<br>    <br>       <b>try <br>       </b>{  <b>double </b>fvalue = future_value(init, interest, years); <br>          cout &lt;&lt; <font color="#ff0000">"The future value is " </font>&lt;&lt; fvalue &lt;&lt; endl;  <br>       }<br>       <b>catch </b>(logic_error&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A logic error has occurred "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       }       <br>       cout &lt;&lt; <font color="#ff0000">"Retry? (y/n)"</font>;<br>       <b>char </b>input;<br>       cin &gt;&gt; input;<br>       <b>if </b>(input == 'n') more = <b>false</b>;<br>    } <br><font color="#000080"><i>&nbsp;</i></font><b>return </b><font color="#800080">0</font>;<br> }<br></font></font></code></pre>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
  </body>
</html>
