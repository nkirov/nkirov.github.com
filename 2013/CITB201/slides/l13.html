<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;
      charset=windows-1251">
    <meta name="Author" content="Nikolay Kirov">
    <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U)
      [Netscape]">
    <title>l13</title>
  </head>
  <body>
    <center>
      <h3> <b>13. Шаблони</b></h3>
    </center>
    <img alt="" src="../b5.gif" height="18" width="20">&nbsp; Шаблони. <br>
    &nbsp;&nbsp;&nbsp; Класът&nbsp; <b><tt><font color="#000099">List</font></tt></b>
    (вж 20. Реализация на свързани списъци) съхранява свързан списък от
    низове, но ние искаме да може да съхранява стойности от произволен
    тип, както може стандартният клас <b><tt>list</tt></b>. За тази цел
    дефинираме шаблон на клас, като задаваме формален параметър <b><tt><font
          color="#000099">T</font></tt></b> на шаблона с конструкцията <br>
    <b><tt><font color="#000099">template&lt;typename T&gt; class List;</font></tt></b>
    <br>
    и фактически параметър на шаблона по познатата схема <br>
    <b><tt><font color="#000099">List&lt;string&gt; staff;</font></tt></b>
    <br>
    &nbsp;&nbsp;&nbsp; Ще пренапишем класовете, поддържащи свързан
    списък като използваме предефиниране на операции и шаблони. <br>
    <b><tt><font color="#000099">// list3.cpp</font></tt></b> <br>
    <b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
    <br>
    <b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
    <br>
    <b><tt><font color="#000099">#include &lt;cassert&gt;</font></tt></b>
    <br>
    <b><tt><font color="#000099">using namespace std;</font></tt></b>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">class List;</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">class Iterator;</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">class Link&nbsp; {</font></tt></b> <br>
      <b><tt><font color="#000099">public:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link(T s);</font></tt></b>
      <br>
      <b><tt><font color="#000099">private:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; T data;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *previous;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *next;</font></tt></b>
      <br>
      <b><tt><font color="#000099">friend class List&lt;T&gt;;</font></tt></b>
      <br>
      <b><tt><font color="#000099">friend class Iterator&lt;T&gt;;</font></tt></b>
      <br>
      <b><tt><font color="#000099">};</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">class List&nbsp;&nbsp; {</font></tt></b>
      <br>
      <b><tt><font color="#000099">public:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; List();</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; void push_back(T);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; void
            insert(Iterator&lt;T&gt;, T);</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; void
            erase(Iterator&lt;T&gt;);</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Iterator&lt;T&gt;
            begin();</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Iterator&lt;T&gt; end();</font></tt></b>
      <br>
      <b><tt><font color="#000099">private:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *first;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *last;</font></tt></b>
      <br>
      <b><tt><font color="#000099">};</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">class Iterator&nbsp;&nbsp; {</font></tt></b>
      <br>
      <b><tt><font color="#000099">public:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Iterator();</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; T operator*() const;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; void operator++(int);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; void operator--(int);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; bool
            operator!=(Iterator&lt;T&gt;) const;</font></tt></b> <br>
      <b><tt><font color="#000099">private:</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *position;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; Link&lt;T&gt; *last;</font></tt></b>
      <br>
      <b><tt><font color="#000099">friend class List&lt;T&gt;;</font></tt></b>
      <br>
      <b><tt><font color="#000099">};</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">Link&lt;T&gt;::Link(T s)</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ data = s;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; previous = NULL;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; next = NULL; }</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">List&lt;T&gt;::List()</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ first = NULL; last = NULL; }</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">void List&lt;T&gt;::push_back(T s)</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ Link&lt;T&gt; *newlink = new
            Link&lt;T&gt;(s);</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; if (last == NULL)</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; { first = newlink; last =
            newlink; }</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; else</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; { newlink-&gt;previous = last;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; last-&gt;next =
            newlink;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; last = newlink;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; }</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">void
            List&lt;T&gt;::insert(Iterator&lt;T&gt; iter, T s)</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ if (iter.position == NULL)</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; { push_back(s); return; }</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *after =
            iter.position;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *before =
            after-&gt;previous;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *newlink = new
            Link&lt;T&gt;(s);</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; newlink-&gt;previous = before;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; newlink-&gt;next = after;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; after-&gt;previous = newlink;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; if (before == NULL) first =
            newlink;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;
            else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            before-&gt;next = newlink;</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">void
            List&lt;T&gt;::erase(Iterator&lt;T&gt; iter)</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ assert(iter.position != NULL);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *remove =
            iter.position;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *before =
            remove-&gt;previous;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; Link&lt;T&gt; *after =
            remove-&gt;next;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; if (remove == first) first =
            after;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;
            else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            before-&gt;next = after;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; if (remove == last) last =
            before;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;
            after-&gt;previous = before;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; iter.position = after;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; delete remove;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">Iterator&lt;T&gt;
            List&lt;T&gt;::begin()</font></tt></b> <br>
      <b><tt><font color="#000099">{ Iterator&lt;T&gt; iter;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; iter.position = first;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; iter.last = last;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; return iter;</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">Iterator&lt;T&gt;
            List&lt;T&gt;::end()</font></tt></b> <br>
      <b><tt><font color="#000099">{ Iterator&lt;T&gt; iter;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; iter.position = NULL;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; iter.last = last;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; return iter;</font></tt></b> <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">Iterator&lt;T&gt;::Iterator()</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ position = NULL; last = NULL; }</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">T Iterator&lt;T&gt;::operator*()
            const</font></tt></b> <br>
      <b><tt><font color="#000099">{ assert(position != NULL);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; return position-&gt;data;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">void
            Iterator&lt;T&gt;::operator++(int dummy)</font></tt></b> <br>
      <b><tt><font color="#000099">{ assert(position != NULL);</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; position = position-&gt;next;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">void
            Iterator&lt;T&gt;::operator--(int dummy)</font></tt></b> <br>
      <b><tt><font color="#000099">{ if (position == NULL)&nbsp;
            position = last;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;
            else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
position

            = position-&gt;previous;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; assert(position != NULL);</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b> </p>
    <p><b><tt><font color="#000099">template&lt;typename T&gt;</font></tt></b>
      <br>
      <b><tt><font color="#000099">bool
            Iterator&lt;T&gt;::operator!=(Iterator&lt;T&gt; b) const</font></tt></b>
      <br>
      <b><tt><font color="#000099">{ return position != b.position; }</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">int main()</font></tt></b> <br>
      <b><tt><font color="#000099">{ List&lt;string&gt; staff;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; staff.push_back("Cracker,
            Carl");</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; staff.push_back("Hacker,
            Harry");</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; staff.push_back("Lam, Larry");</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; staff.push_back("Sandman,
            Susan");</font></tt></b> </p>
    <p><b><tt><font color="#000099">/* добавя елемент на четвърто място
            */</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; Iterator&lt;string&gt; pos;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; pos = staff.begin();</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; pos++; pos++; pos++;</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; staff.insert(pos, "Reindeer,
            Rudolf");</font></tt></b> </p>
    <p><b><tt><font color="#000099">/* отстранява втория елемент */</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; pos = staff.begin();</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; pos++;</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp; staff.erase(pos);</font></tt></b>
    </p>
    <p><b><tt><font color="#000099">/* отпечатва свързания списък */</font></tt></b>
      <br>
      <b><tt><font color="#000099">&nbsp; for (pos = staff.begin(); pos
            != staff.end(); pos++)</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; cout
            &lt;&lt; *pos &lt;&lt; "\n";</font></tt></b> <br>
      <b><tt><font color="#000099">&nbsp;&nbsp; return 0;</font></tt></b>
      <br>
      <b><tt><font color="#000099">}</font></tt></b>
      <table border="" cellpadding="4" width="100%">
        <tbody>
          <tr>
            <td><b><tt><font color="#993300">Cracker, Carl</font></tt></b>
              <br>
              <b><tt><font color="#993300">Lam, Larry</font></tt></b> <br>
              <b><tt><font color="#993300">Reindeer, Rudolf</font></tt></b>
              <br>
              <b><tt><font color="#993300">Sandman, Susan</font></tt></b></td>
          </tr>
        </tbody>
      </table>
    </p>
  </body>
</html>
