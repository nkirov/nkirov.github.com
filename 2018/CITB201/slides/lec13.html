<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="Author" content="Nikolay Kirov">
    <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U)
      [Netscape]">
    <title>l14</title>
  </head>
  <body>
    <center>
      <h3 align="left">13. Обработка на изключения</h3>
    </center>
    <i>План:</i><br>
    Обработка на грешки<br>
    Изхвърляне на изключения<br>
    Прихващане на изключения<br>
    Развиване на стека<br>
    Спецификации на изключенията<br>
    <hr size="2" width="100%"><img alt="" src="../b5.gif" width="20"
      height="18"><b>Обработка на грешки</b><br>
    Как да се обработват (логически) грешки, възникващи във функция или
    клас?<br>
    <i>Пример:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b>cout &lt;&lt; future_value(1000, -100, -1);</b></font></pre>
    ** Не се проверяват условия за грешки и се изпълнява програмата.
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font><br></pre>
    ** Проверяват се условията за грешка, не се прави нищо в случай на
    грешка (връща се фалшива стойност).<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0) </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> 0;</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    ** Проверяват се условията за грешка, съобщава се за грешката и се
    спира изпълнението на програмата. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  assert(p &gt;= 0 &amp;&amp; n &gt;= 0);</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    Въникващи проблеми:<br>
    ** Ако не се прави проверка за грешка, програмата е ненадеждна.<br>
    ** Ако се върне фалшива стойност, програмата продължава да използва
    стойността - никой не знае каква е грешката.<br>
    ** Много реални програми не могат да бъдат спирани като тези, които
    управляват ракета, самолет или медицинско устройство.<br>
    <hr size="2" width="100%"> <b><img alt="" src="../b5.gif"
        width="20" height="18">Изхвърляне на изключения</b><br>
    C++ има механизъм за уведомяване и обработка на изключения. <br>
    Когато дадена функция открие грешка, тя може да сигнализира за
    състояние (изхвърли изключение) към някоя друга част на програмата,
    чиято работа е да обработва грешки.&nbsp; <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{  </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>   {  </b><b>logic_error</b><b> <font color="#cc0000">description</font>("illegal future_value parameter");</b><b><br></b><b>      </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> description;</b><b><br></b><b>   }</b><b><br></b><b>   </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><b><br></b><b>}</b></font></pre>
    Може да не се задава име на обекта за обработка на изключения:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><b><span style="color: rgb(51, 51, 255);">double</span></b><b> future_value(</b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> initial_balance, </b><b><span style="color: rgb(51, 51, 255);">double</span></b><b> p, </b><b><span style="color: rgb(51, 51, 255);">int</span></b><b> n)</b><b><br></b><b>{ </b><b><span style="color: rgb(51, 51, 255);">if</span></b><b> (p &lt; 0 || n &lt; 0)</b><b><br></b><b>    </b><b><span style="color: rgb(51, 51, 255);">throw</span></b><b> </b><b>logic_error</b><b>("illegal future_value parameter");</b><b><br></b><b> </b><b><span style="color: rgb(51, 51, 255);">return</span></b><b> initial_balance * pow(1 + p / 100, n);</b><br>}</font></pre>
    Тук <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> е стандартен клас за изключения,
    който е дефиниран в заглавния файл&nbsp; <span style="color: rgb(0,
      0, 0); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">&lt;stdexcept&gt;</span>.<br>
    Ключовата дума <font size="+1"><tt>throw</tt> </font>показва, че
    изпълнението на функциятя спира незабавно, но управлението не се
    връща на извикващата функция, а се търси частта от програмата за
    обработка на изключения.<br>
    <hr size="2" width="100%"> <b><img alt="" src="../b5.gif"
        width="20" height="18">Прихващане на изключения</b><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br>   // <i>code</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>{<br>   <i>// handler</i><br>}</font></pre>
    Ако някоя от функциите в блока <span style="color: rgb(51, 51,
      255); font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; font-weight: bold; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">try</span>
    изхвърли изключение <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-size-adjust: auto;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">logic_error</span>,
    или вика друга функция, която изхвърля такова изключение, блокът на
    <b><tt><span style="color: rgb(0, 0, 0); font-size: large;
          font-style: normal; font-variant: normal; font-weight: normal;
          letter-spacing: normal; line-height: normal; text-align: left;
          text-indent: 0px; text-transform: none; white-space: normal;
          word-spacing: 0px; background-color: rgb(255, 255, 255);
          display: inline ! important; float: none;">catch<b>(</b></span></tt></b><b><tt><span
          style="color: rgb(0, 0, 0); font-size: large; font-style:
          normal; font-variant: normal; font-weight: normal;
          letter-spacing: normal; line-height: normal; text-align: left;
          text-indent: 0px; text-transform: none; white-space: normal;
          word-spacing: 0px; background-color: rgb(255, 255, 255);
          display: inline ! important; float: none;"><b><span
              style="color: rgb(0, 0, 0); font-family: monospace;
              font-size: large; font-style: normal; font-variant:
              normal; font-weight: normal; letter-spacing: normal;
              line-height: normal; orphans: auto; text-align: left;
              text-indent: 0px; text-transform: none; white-space:
              normal; widows: auto; word-spacing: 0px;
              -webkit-text-size-adjust: auto; -webkit-text-stroke-width:
              0px; background-color: rgb(255, 255, 255); display: inline
              !important; float: none;">logic_error</span>)</b></span></tt></b>
    се изпълнява веднага.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">while</span> (more)<br>{  <span style="color: rgb(51, 51, 255); font-weight: bold;">try</span> <br>   {<br>      <i>// code</i><br>   }<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<span style="font-weight: bold;">logic_error</span>&amp; e)<br>   {  cout &lt;&lt; "A logic error has occurred "<br>           &lt;&lt; e.what() &lt;&lt; "\n";<br>      ........<br>   }<br>}</font></pre>
    Член-функцията <b><span style="color: rgb(0, 0, 0); font-family:
        monospace; font-size: large; font-style: normal; font-variant:
        normal; font-weight: normal; letter-spacing: normal;
        line-height: normal; orphans: auto; text-align: left;
        text-indent: 0px; text-transform: none; white-space: normal;
        widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto;
        -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
        255); display: inline !important; float: none;">what</span></b>
    от класа <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: bold; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">logic_error</span> връща низа, който е зададен като
    параметър при конструиране на обекта в оператора <span
      style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;"><tt>throw</tt><span class="Apple-converted-space"></span></span>.<br>
    <br>
    <table cellpadding="4" bgcolor="#00ffff" border="1">
      <tbody>
        <tr>
          <td bgcolor="#ffffff">
            <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{</font><i><font size="+1"><br></font></i><font size="+1"> <i>statements</i> <br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>1</sub> <i>variable_name</i><sub>1</sub>)<br>{<br> <i>statements</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>2</sub> <i>variable_name</i><sub>2</sub>)<br>{<br> <i>statements</i><br>}<br>...<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (<i>type_name</i><sub>n</sub> <i>variable_name</i><sub>n</sub>)<br>{<br> <i>statements</i><br>}</font></pre>
            <table cellpadding="4" border="0">
              <tbody>
                <tr>
                  <td valign="top"><font size="+1" color="#00ffff"><font
                        size="+1">Пример</font>:</font></td>
                  <td>
                    <pre><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br> double fvalue = future_value(init, interest, years); <br> cout &lt;&lt; "The future value is " &lt;&lt; fvalue &lt;&lt; endl;<br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span>(logic_error&amp; e)<br>{<br> cout &lt;&lt; "Processing error " &lt;&lt; e.what() &lt;&lt; "\n";<br>}</font></pre>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
    <br class="Apple-interchange-newline">
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-size-adjust: auto; -webkit-text-stroke-width: 0px;"><code><font face="Courier New" size="3"><font color="#000000"><font color="#008000"> //<a href="../../../2014/NETB151/sources/ch17/exception1.cpp">exception1.cpp</a><br><font size="3"> #</font>include </font>&lt;iostream&gt;<br> <font color="#008000">#include </font>&lt;stdexcept&gt;<br> </font></font></code><code><font><font><font><font face="Courier New" size="3"><font color="#000000"><font color="#008000">#include</font></font></font></font></font></font></code><code><font face="Courier New" size="3"><font color="#000000"> &lt;cmath&gt;<br> <b>using namespace </b>std;<br><br> <b>double </b>future_value(<b>double </b>initial_balance, <b>double </b>p, <b>int </b>n)<br>{  <b>if </b>(p &lt; <font color="#800080">0 </font>|| n &lt; <font color="#800080">0</font>)<br>   {  logic_error description(<font color="#ff0000">"illegal future_value parameter"</font>);<br>      <b>throw </b>description;<br>   }<br>   <b>return </b>initial_balance * pow(<font color="#800080">1 </font>+ p / <font color="#800080">100</font>, n);<br>}<br><br> <b>int </b>main()<br> {  <b>bool </b>more = <b>true</b>;<br>    <b>while </b>(more)<br>    {  <b>double </b>init, interest;<br>       <b>int </b>years;<br>       cout &lt;&lt; <font color="#ff0000">"Enter initial value, interest and years: "</font>;<br>       cin &gt;&gt; init &gt;&gt; interest &gt;&gt; years;<br>    <br>       <b>try <br>       </b>{  <b>double </b>fvalue = future_value(init, interest, years); <br>          cout &lt;&lt; <font color="#ff0000">"The future value is " </font>&lt;&lt; fvalue &lt;&lt; endl;  <br>       }<br>       <b>catch </b>(logic_error&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A logic error has occurred "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       }       <br>       cout &lt;&lt; <font color="#ff0000">"Retry? (y/n)"</font>;<br>       <b>char </b>input;<br>       cin &gt;&gt; input;<br>       <b>if </b>(input == 'n') more = <b>false</b>;<br>    } <br><font color="#000080"><i>&nbsp;</i></font><b>return </b><font color="#800080">0</font>;<br> }<br></font></font></code></pre>
    Добре е всяко изключение да се дефинира като отделен клас. <br>
    <i>Пример:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">class</span> FutureValueError : <span style="color: rgb(51, 51, 255);">public</span> <span style="font-weight: bold;">logic_error</span> {<br><span style="color: rgb(51, 51, 255);">public:</span><br>   FutureValueError(<span style="color: rgb(51, 51, 255);">const</span> <span style="color: rgb(51, 51, 255);">char</span> reason[]);<br>};<br><br>FutureValueError::FutureValueError(<span style="color: rgb(51, 51, 255);">const</span> <span style="color: rgb(51, 51, 255);">char</span> reason[])<br>   : <span style="font-weight: bold;">logic_error</span>(reason){}</font></pre>
    и функцията <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">future_value</span> може да изхвърли <span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">FutureValueError</span>&nbsp;







    обект:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">if</span> (p &lt; 0 || n &lt; 0)<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> FutureValueError("illegal parameter");</font></pre>
    Тъй като <span style="color: rgb(0, 0, 0); font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">FutureValueError</span>&nbsp;







    е&nbsp; <font size="+1"><tt style="color: rgb(0, 0, 0); font-style:
        normal; font-variant: normal; letter-spacing: normal;
        line-height: normal; orphans: auto; text-align: left;
        text-indent: 0px; text-transform: none; white-space: normal;
        widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;
        background-color: rgb(255, 255, 255); font-weight: bold;">logic_error</tt></font><span
      style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: large; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: left; text-indent: 0px; text-transform:
      none; white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">,</span> то това
    изключение може да се прихване от <span style="font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;">catch</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">(</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; letter-spacing:
      normal; line-height: normal; orphans: auto; text-align: left;
      text-indent: 0px; text-transform: none; white-space: normal;
      widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); font-weight: bold;">logic_erro</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">r&amp;&nbsp;e).</span><br>
    Разбира се, може да построим и специално за него <span
      style="font-family: monospace; font-size: large; font-style:
      normal; font-variant: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); color: rgb(51, 51, 255);
      font-weight: bold;">catch</span> блок:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{<br>   <i>// code</i><br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (FutureValueError&amp; e)<br>{<br>   <i>// handler</i><sub>1</sub><br>} <br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span> (logic_error&amp; e)<br>{<br>   <i>// handler</i><sub>2</sub><br>}</font></pre>
    В този случай ще се изпълни само първия <span style="font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;">catch</span>
    блок.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code><font face="Courier New" size="3"><font color="#008000">// <font size="3"><a href="../../../2014/NETB151/sources/ch17/exception2.cpp">exception2.cpp</a><br></font>#include </font>&lt;iostream&gt;<br><font color="#008000">#include </font>&lt;stdexcept&gt;<br></font></code><code></code><code><font><font><font><font face="Courier New" size="3"><font color="#000000"><font color="#008000">#include</font></font></font></font></font></font></code><code><font face="Courier New" size="3"><font color="#000000"> &lt;cmath&gt;</font></font></code><br><code><font face="Courier New" size="3"><b>using namespace </b>std;<br> <br><b>class </b>FutureValueError : <b>public </b>logic_error {<br><b>public</b>:<br>   FutureValueError(<b>const char </b>reason[]);<br>};<br><br>FutureValueError::FutureValueError(<b>const char </b>reason[])<br>   : logic_error(reason){}<br><br><b>double </b>future_value(<b>double </b>initial_balance, <b>double </b>p, <b>int </b>n)<br>{  <b>if </b>(p &lt; <font color="#800080">0 </font>|| n &lt; <font color="#800080">0</font>)<br>     <b>throw </b>FutureValueError(<font color="#ff0000">"illegal future_value parameter"</font>);<br>   <b>return </b>initial_balance * pow(<font color="#800080">1 </font>+ p / <font color="#800080">100</font>, n);<br>}<br><br><b>void </b>read(<b>double</b>&amp; init, <b>double</b>&amp; interest, <b>int</b>&amp; years)<br>{  cout &lt;&lt; <font color="#ff0000">"Enter initial value, interest and years: "</font>;<br>   cin &gt;&gt; init &gt;&gt; interest &gt;&gt; years;<br>   <b>if </b>(years &gt; <font color="#800080">100</font>) <b>throw </b>logic_error(<font color="#ff0000">"too many years!"</font>);<br>   cout &lt;&lt; init &lt;&lt; <font color="#ff0000">" " </font>&lt;&lt; interest &lt;&lt; <font color="#ff0000">" " </font>&lt;&lt; years &lt;&lt; endl;<br>}<br><br><b>int </b>main()<br>{  <b>bool </b>more = <b>true</b>;<br>   <b>while </b>(more)<br>    {  <b>double </b>init, interest;<br>       <b>int </b>years;<br>       <b>try<br>       </b>{  read(init, interest, years);<br>          <b>double </b>fvalue = future_value(init, interest, years); <br>          cout &lt;&lt; <font color="#ff0000">"The future value is " </font>&lt;&lt; fvalue &lt;&lt; endl;  <br>       }<br>       <font color="#000080"><i>/**/<br>       </i></font><b>catch </b>(FutureValueError&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A FutureValueError has occurred: "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       } <br>       <font color="#000080"><i>/**/      <br>       </i></font><b>catch </b>(logic_error&amp; e)<br>       {  cout &lt;&lt; <font color="#ff0000">"A logic error has occurred: "<br>               </font>&lt;&lt; e.what() &lt;&lt; <font color="#ff0000">"\n"</font>;<br>       }       <br>       cout &lt;&lt; <font color="#ff0000">"Retry? (y/n)"</font>;<br>       <b>char </b>input;<br>       cin &gt;&gt; input;<br>       <b>if </b>(input == 'n') more = <b>false</b>;<br>    } <font color="#000080"><i><br>    </i></font><b>return </b><font color="#800080">0</font>;<br> }<br></font></code></pre>
    <hr size="2" width="100%"> <b><img alt="" src="../b5.gif"
        width="21" height="18">Развиване на стека</b><br>
    Често механизмът за обработка на изключения се прилага при вход на
    данни. <br>
    Пример (виж <b><a
        href="../../../2014/NETB101/sources/ch6/product2.cpp"><tt>product2.cpp</tt></a></b>).<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">bool</span> Product::read(fstream&amp; fs)<br>{  getline(fs, name);<br>   <span style="color: rgb(51, 51, 255);">if</span> (name == "") <span style="color: rgb(51, 102, 255);">return</span> false; // end of file<br>   fs &gt;&gt; price &gt;&gt; score;<br>   <span style="color: rgb(51, 51, 255);">if</span> (fs.fail())<br>      <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> <span style="font-weight: bold;">runtime_error</span>("Error while reading product");<br>   string remainder;<br>   getline(fs, remainder);<br>   <span style="color: rgb(51, 51, 255);">return</span> true;<br>}</font></pre>
    Когато възникне логическа грешка, никога няма смисъл да се повтори
    същата операция, но при <font size="+1"><tt>runtime_error</tt></font>
    има шанс да се повтори операцията и грешката да се избегне. <br>
    Има съществена разлика при обработката на край на файла и грешка при
    входа. <br>
    <br>
    Йерархията на стандартните класове за обработка на изключения е
    следната:<br>
    <img alt=""
      src="../../../2014/NETB151/slides/ch17/images/exceptions.png"
      width="756" height="431"><br>
    <br>
    Нека имаме следната функция (виж <tt><a
        href="../../../2014/NETB101/sources/ch9/bestval2.cpp">bestval2.cpp</a></tt>):<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>{  vector&lt;Product&gt; products;<br>   <span style="color: rgb(51, 51, 255);">bool</span> more = true;<br>   <span style="color: rgb(51, 51, 255);">while</span> (more)<br>   {  Product p;<br>      <span style="color: rgb(51, 51, 255);">if</span> (p.read(fs)) products.push_back(p);<br>      <span style="color: rgb(51, 51, 255);">else</span> more = false;<br>   }<br>   <i>// do something with</i> products<br>}</font></pre>
    Когато функцията <span style="color: rgb(0, 0, 0); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: normal; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">read</span> изхвърли изключение, функцията <span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">process_products</span>
    прекъсва и механизмът за обработка на изключения търси подходящ <span
      style="color: rgb(51, 51, 255); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      bold; letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">catch</span> блок.
    При прекъсването се изпълняват всички деструктори на локалните
    обекти. <br>
    В случая обектът&nbsp; <span style="color: rgb(0, 0, 0);
      font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">products</span> (от класа&nbsp; <span style="color:
      rgb(0, 0, 0); font-family: 'Times New Roman'; font-size: large;
      font-style: normal; font-variant: normal; font-weight: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">vector</span>) ще
    бъде унищожен.<br>
    Когато имаме указатели, трябва да се погрижим за унищожаването на
    обектите в динамичната памет.<br>
    <i>Пример:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1">Product* p = <span style="color: rgb(51, 51, 255);">new</span> Product();<br><span style="color: rgb(51, 51, 255);">if</span> (p-&gt;read())<br>{<br>   ...<br>}<br><span style="color: rgb(51, 51, 255);">delete</span> p; // never executes if read throws an exception</font></pre>
    генерира "memory leak", ако функцията <span style="color: rgb(0, 0,
      0); font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">read</span> изхвърли изключение (виж <tt><a
        href="../../../2014/NETB151/sources/ch17/product1.cpp">product1.cpp</a></tt>).







    <br>
    В такъв случай може да се използва следната конструкция:<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1">Product* p = NULL;<br><span style="color: rgb(51, 51, 255); font-weight: bold;">try</span><br>{  p = <span style="color: rgb(51, 51, 255);">new</span> Product();<br>   if (p-&gt;read())<br>   {<br>      ...<br>   }<br>   <span style="color: rgb(51, 51, 255);">delete</span> p;<br>}<br><span style="color: rgb(51, 51, 255); font-weight: bold;">catch</span>(...)<br>{  <span style="color: rgb(51, 51, 255);">delete</span> p;<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span>;<br>}</font></pre>
    Блокът <span style="font-family: monospace; font-size: large;
      font-style: normal; font-variant: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); color: rgb(51, 51, 255);
      font-weight: bold;">catch</span><span style="color: rgb(0, 0, 0);
      font-family: monospace; font-size: large; font-style: normal;
      font-variant: normal; font-weight: normal; letter-spacing: normal;
      line-height: normal; orphans: auto; text-align: left; text-indent:
      0px; text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">(...)</span> обработва всяко изключение, а
    операторът <span style="color: rgb(51, 51, 255); font-family:
      monospace; font-size: large; font-style: normal; font-variant:
      normal; font-weight: bold; letter-spacing: normal; line-height:
      normal; orphans: auto; text-align: left; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;
      background-color: rgb(255, 255, 255); display: inline !important;
      float: none;">throw</span>&nbsp; без обект изпраща изключението да
    се обработва от друг <span style="font-family: monospace;
      font-size: large; font-style: normal; font-variant: normal;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); color: rgb(51, 51, 255); font-weight: bold;">catch</span><span
      style="color: rgb(0, 0, 0); font-family: monospace; font-size:
      large; font-style: normal; font-variant: normal; font-weight:
      normal; letter-spacing: normal; line-height: normal; orphans:
      auto; text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;"></span> блок.<br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><code><span style="font-family: 'Courier New'; font-style: normal; font-variant: normal; font-weight: normal; font-size: 10pt; line-height: normal;"><span class="cpp1-preprocessor" style="color: rgb(0, 128, 0);">// <a href="../../../2014/NETB151/sources/ch17/product2.cpp">product2.cpp</a><br>#include &lt;iostream&gt;<br>#include &lt;fstream&gt;<br>#include &lt;stdexcept&gt;<br>#include &lt;vector&gt;<br></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">using</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">namespace</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> std;<br> <br></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">class</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Product {<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">public</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">:<br>       Product();<br>       </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">bool</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> read(istream&amp; fs);<br>       </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">void</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> print() </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">const</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">; <br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">private</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">:<br>       string name;<br>       </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">double</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> price;<br>       </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> score;<br>};    <br><br>Product::Product()<br>{ price = </span><span class="cpp1-number" style="color: rgb(128, 0, 128);">0</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br>  score = </span><span class="cpp1-number" style="color: rgb(128, 0, 128);">0</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;                <br>}<br><br></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">bool</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Product::read(istream&amp; fs)<br>{  cout &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">"Product: "</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br>   getline(fs, name);<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">if</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (name == </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">""</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">) </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">return</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">false</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">; </span><span class="cpp1-comment" style="color: rgb(10, 36, 106); font-style: italic;">// end of file<br></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">   fs &gt;&gt; price &gt;&gt; score;<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">if</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (fs.fail())<br>      </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">throw</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> runtime_error(</span><span class="cpp1-string" style="color: rgb(255, 0, 0);">"Error while reading product"</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">);<br>   string remainder;<br>   getline(fs, remainder);   <br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">return</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">true</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br>}<br><br></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">void</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Product::print() </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">const<br></span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">{ cout &lt;&lt; name &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">" "</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> &lt;&lt; price &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">" "</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> &lt;&lt; score &lt;&lt; endl;<br>} <br>  <br></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">void</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> process_products(istream&amp; fs)<br>{  vector&lt;Product*&gt; products;<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">bool</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> more = </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">true</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">while</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (more)<br>   {  Product* p = </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">new</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> Product;<br>      </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">try<br></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">      {  </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">if</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (p-&gt;read(fs)) products.push_back(p);<br>         </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">else</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> more = </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">false</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br>      }   <br>      </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">catch</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">(runtime_error&amp; r)  </span><span class="cpp1-comment" style="color: rgb(10, 36, 106); font-style: italic;">// runtime_error&amp; r)<br></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">      {  cout &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">"1. "</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> &lt;&lt; r.what() &lt;&lt; endl;<br>         </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">for</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (</span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> i = </span><span class="cpp1-number" style="color: rgb(128, 0, 128);">0</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">; i &lt; products.size(); i++)<br>                                </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">delete</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> products[i];</span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;"><br>         throw; </span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"></span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;"></span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">                                                                    <br>      }                     <br>    }     <br>   </span><span class="cpp1-comment" style="color: rgb(10, 36, 106); font-style: italic;">/* processing products */</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">       <br>   <br>   cout &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">"Print:"</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> &lt;&lt; endl;<br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">for</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> (</span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> i = </span><span class="cpp1-number" style="color: rgb(128, 0, 128);">0</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">; i &lt; products.size(); i++)<br>   {  products[i]-&gt;print();<br>      </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">delete</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> products[i];<br>   }      <br>}<br><br> </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">int</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> main()<br> {  </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">try<br></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">    {  process_products(cin);<br>    }<br>    </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">catch</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">(runtime_error&amp; r)  </span><span class="cpp1-comment" style="color: rgb(10, 36, 106); font-style: italic;">// runtime_error&amp; r)<br></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);">    { cout &lt;&lt; </span><span class="cpp1-string" style="color: rgb(255, 0, 0);">"2. "</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> &lt;&lt; r.what() &lt;&lt; endl;                <br>    }                        <br>   </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;"></span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"><br>    </span><span class="cpp1-reservedword" style="color: rgb(0, 0, 0); font-weight: bold;">return</span><span class="cpp1-space" style="background-color: rgb(255, 255, 255); color: rgb(0, 0, 0);"> </span><span class="cpp1-number" style="color: rgb(128, 0, 128);">0</span><span class="cpp1-symbol" style="color: rgb(0, 0, 0);">;<br> }</span></span></code></pre>
    <hr size="2" width="100%"> <b><img alt="" src="../b5.gif"
        width="20" height="18"></b><b>Спецификации на изключенията</b><br>
    <br>
    При дефинирането на функция, можем да определим кои изключения може
    да изхвърля тази функция. <br>
    <i>Например:</i><br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>     <span style="color: rgb(51, 51, 255); font-weight: bold;">throw</span> (UnexpectedEndOfFile, bad_alloc)</font></pre>
    означава, че само зададените две изключения са позволени на тази
    функция. <br>
    <pre style="color: rgb(0, 0, 0); font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><font size="+1"><span style="color: rgb(51, 51, 255);">void</span> process_products(fstream&amp; fs)<br>   <span style="color: rgb(51, 51, 255); font-weight: bold;">  throw</span> ()</font></pre>
    задава забрана за всички изключения, а липса на <span style="color:
      rgb(51, 51, 255); font-family: monospace; font-size: large;
      font-style: normal; font-variant: normal; font-weight: bold;
      letter-spacing: normal; line-height: normal; orphans: auto;
      text-align: left; text-indent: 0px; text-transform: none;
      white-space: normal; widows: auto; word-spacing: 0px;
      -webkit-text-stroke-width: 0px; background-color: rgb(255, 255,
      255); display: inline !important; float: none;">throw</span>
    означава разрешение за изключения от всеки тип.<br>
    <i>Пример: </i><a href="../sources/exept.cpp"><font size="+1"><tt>except.cpp</tt></font></a><br>
    <ul style="color: rgb(0, 0, 0); font-family: 'Times New Roman';
      font-size: medium; font-style: normal; font-variant: normal;
      font-weight: normal; letter-spacing: normal; line-height: normal;
      orphans: auto; text-align: start; text-indent: 0px;
      text-transform: none; white-space: normal; widows: auto;
      word-spacing: 0px; -webkit-text-stroke-width: 0px;">
      <li> <font size="+1">Stroustrup's example:<span
            class="Apple-converted-space">&nbsp;</span></font><font
          size="+1"><span style="font-family: monospace;">class Vector</span></font><font
          size="+1"><span class="Apple-converted-space">&nbsp;</span>(</font><a
          href="../../../2014/NETB151/sources/ch17/strous.cpp"
          style="font-weight: bold;"><font size="+1"><span
              style="font-family: monospace;">strous.cpp</span></font></a><font
          size="+1">)</font> </li>
    </ul>
    <hr size="2" width="100%">
  </body>
</html>
