<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta name="Author" content="Nikolay Kirov">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U) [Netscape]">
   <title>l05</title>
</head>
<body>

<hr width="100%">
<br><b> 5. Модули</b>
<p><img src="bullet.gif" height="18" width="20" align="ABSCENTER"> Разделно компилиране
</p>
<p><img src="bullet.gif" height="18" width="20" align="ABSCENTER"> Създаване
на заглавни файлове
<br>* Стек - пример
<br><b><tt><font color="#CC6600">   s.push("Able")</font></tt></b>
<br><b><tt><font color="#CC6600">   s.push("Backer")</font></tt></b>
<br><b><tt><font color="#CC6600">   s.push("Charlie")</font></tt></b>
<br><b><tt><font color="#CC6600">   s.pop() -&gt; "Charlie"</font></tt></b>
<br><b><tt><font color="#CC6600">   s.push("Delta")</font></tt></b>
<br><b><tt><font color="#CC6600">   s.pop() -&gt; "Delta"</font></tt></b>
<br><b><tt><font color="#CC6600">   s.pop() -&gt; "Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">   s.pop() -&gt; "Able"</font></tt></b>
<br>* Създаване на клас
<br><b><tt><font color="#006600">class Stack  {</font></tt></b>
<br><b><tt><font color="#006600">public:</font></tt></b>
<br><b><tt><font color="#006600"> Stack();</font></tt></b>
<br><b><tt><font color="#006600"> void push(string s);</font></tt></b>
<br><b><tt><font color="#006600"> string pop();</font></tt></b>
<br><b><tt><font color="#006600"> bool is_empty() const;</font></tt></b>
<br><b><tt><font color="#006600">private:</font></tt></b>
<br><b><tt><font color="#006600"> vector&lt;string&gt; data;</font></tt></b>
<br><b><tt><font color="#006600"> int top;</font></tt></b>
<br><b><tt><font color="#006600">};</font></tt></b>
<br><b><tt><font color="#006600">Stack::Stack() { top = 0; }</font></tt></b>
</p>
<p><b><tt><font color="#006600">void Stack::push(string s)</font></tt></b>
<br><b><tt><font color="#006600">{</font></tt></b>
<br><b><tt><font color="#006600"> if (top &lt; data.size()) data[top]
= s;</font></tt></b>
<br><b><tt><font color="#006600"> else data.push_back(s);</font></tt></b>
<br><b><tt><font color="#006600"> top++;</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><b><tt><font color="#006600">string Stack::pop()</font></tt></b>
<br><b><tt><font color="#006600">{</font></tt></b>
<br><b><tt><font color="#006600"> assert(top &gt; 0);</font></tt></b>
<br><b><tt><font color="#006600"> top--;</font></tt></b>
<br><b><tt><font color="#006600"> return data[top];</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><b><tt><font color="#006600">bool Stack::is_empty() const  { 
return top == 0;  }</font></tt></b>
</p>
<p>* Разделяне на информацията между <b><tt><font color="#006600">stack.h</font></tt></b>
и <b><tt><font color="#006600">stack.cpp</font></tt></b>
<br><b><tt><font color="#006600">// </font><font color="#993300">stack.h</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;vector&gt;</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#006600">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#006600">class Stack  {</font></tt></b>
<br><b><tt><font color="#006600">public:</font></tt></b>
<br><b><tt><font color="#006600"> Stack();</font></tt></b>
<br><b><tt><font color="#006600"> void push(string s);</font></tt></b>
<br><b><tt><font color="#006600"> string pop();</font></tt></b>
<br><b><tt><font color="#006600"> bool is_empty() const;</font></tt></b>
<br><b><tt><font color="#006600">private:</font></tt></b>
<br><b><tt><font color="#006600"> vector&lt;string&gt; data;</font></tt></b>
<br><b><tt><font color="#006600"> int top;</font></tt></b>
<br><b><tt><font color="#006600">};</font></tt></b>
<br><b><tt><font color="#006600">// </font><font color="#993300">stack.cpp</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;cassert&gt;</font></tt></b>
<br><b><tt><font color="#006600">using namespace std;</font></tt></b>
<br><b><tt><font color="#006600">#include "stack.h"</font></tt></b>
</p>
<p><b><tt><font color="#006600">Stack::Stack() { top = 0; }</font></tt></b>
</p>
<p><b><tt><font color="#006600">void Stack::push(string s)</font></tt></b>
<br><b><tt><font color="#006600">{</font></tt></b>
<br><b><tt><font color="#006600"> if (top &lt; data.size()) data[top]
= s;</font></tt></b>
<br><b><tt><font color="#006600"> else data.push_back(s);</font></tt></b>
<br><b><tt><font color="#006600"> top++;</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
</p>
<p><b><tt><font color="#006600">string Stack::pop()</font></tt></b>
<br><b><tt><font color="#006600">{</font></tt></b>
<br><b><tt><font color="#006600"> assert(top &gt; 0);</font></tt></b>
<br><b><tt><font color="#006600"> top--;</font></tt></b>
<br><b><tt><font color="#006600"> return data[top];</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
</p>
<p><b><tt><font color="#006600">bool Stack::is_empty() const {  return
top == 0;  }</font></tt></b>
</p>
<p>*Проблемът за двукратно включване на един и същи заглавен файл в програмата
<br><b><tt><font color="#006600">#ifndef STACK_H</font></tt></b>
<br><b><tt><font color="#006600">#define STACK_H</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">#endif</font></tt></b>
</p>
<p><img src="bullet.gif" height="18" width="20" align="ABSCENTER"> Разделяне
на програмата на няколко първични файла
</p>
<p><b><tt><font color="#993300">// error.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef ERROR_H</font></tt></b>
<br><b><tt><font color="#000099">#define ERROR_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">void error(string message);</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// input.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef INPUT_H</font></tt></b>
<br><b><tt><font color="#000099">#define INPUT_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">bool is_operator(string s);</font></tt></b>
<br><b><tt><font color="#000099">string next_token();</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// eval.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef EVAL_H</font></tt></b>
<br><b><tt><font color="#000099">#define EVAL_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">int precedence(string s);</font></tt></b>
<br><b><tt><font color="#000099">void evaluate(Stack&amp; num, string op);</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// error.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">void error(string message)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   cout &lt;&lt; "ERROR: " &lt;&lt;
message &lt;&lt; ".\n";</font></tt></b>
<br><b><tt><font color="#000099">   exit(1);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#993300">// eval.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;sstream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;cmath&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "eval.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">int precedence(string s)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099"> if (s == "+" or s == "-")      
return 1;</font></tt></b>
<br><b><tt><font color="#000099"> else if (s == "*" or s == "/") 
return 2;</font></tt></b>
<br><b><tt><font color="#000099"> else if (s == "^")             
return 3;</font></tt></b>
<br><b><tt><font color="#000099"> else                           
return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">double string_to_double(string s)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   istringstream instr(s);</font></tt></b>
<br><b><tt><font color="#000099">   double x;</font></tt></b>
<br><b><tt><font color="#000099">   instr &gt;&gt; x;</font></tt></b>
<br><b><tt><font color="#000099">   return x;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string double_to_string(double x)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   ostringstream outstr;</font></tt></b>
<br><b><tt><font color="#000099">   outstr &lt;&lt; x;</font></tt></b>
<br><b><tt><font color="#000099">   return outstr.str();</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">void evaluate(Stack&amp; num, string op)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   if (num.is_empty()) error("Syntax
error");</font></tt></b>
<br><b><tt><font color="#000099">   double y = string_to_double(num.pop());</font></tt></b>
<br><b><tt><font color="#000099">    if (num.is_empty())
error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">   double x = string_to_double(num.pop());</font></tt></b>
<br><b><tt><font color="#000099">   double z;</font></tt></b>
<br><b><tt><font color="#000099">   if (op == "^") z = pow(x,
y);</font></tt></b>
<br><b><tt><font color="#000099">   else if (op == "*") z = x
* y;</font></tt></b>
<br><b><tt><font color="#000099">   else if (op == "/")</font></tt></b>
<br><b><tt><font color="#000099">   {  if (y == 0) error("Divide
by 0");</font></tt></b>
<br><b><tt><font color="#000099">      else z
= x / y;</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099">   else if (op == "+") z = x
+ y;</font></tt></b>
<br><b><tt><font color="#000099">   else if (op == "-") z = x
- y;</font></tt></b>
<br><b><tt><font color="#000099">   else error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">   num.push(double_to_string(z));</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#993300">// input.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;cctype&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "error.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "input.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">bool is_operator(string s)</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099"> return s == "+" or s == "-" or</font></tt></b>
<br><b><tt><font color="#000099">       
s == "*" or s == "/" or s == "^";</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">void skip_whitespace()</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   char ch;</font></tt></b>
<br><b><tt><font color="#000099">   do</font></tt></b>
<br><b><tt><font color="#000099">   {  cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">      if (cin.fail())
return;</font></tt></b>
<br><b><tt><font color="#000099">   }  while (isspace(ch));</font></tt></b>
<br><b><tt><font color="#000099">#ifndef CCC_USE_OLD_STREAMS</font></tt></b>
<br><b><tt><font color="#000099">   cin.unget();</font></tt></b>
<br><b><tt><font color="#000099">#else</font></tt></b>
<br><b><tt><font color="#000099">   cin.putback(ch);</font></tt></b>
<br><b><tt><font color="#000099">/* used if your compiler doesn't support
the ANSI unget function */</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string next_number()</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   string r;</font></tt></b>
<br><b><tt><font color="#000099">   bool more = true;</font></tt></b>
<br><b><tt><font color="#000099">   while (more)</font></tt></b>
<br><b><tt><font color="#000099">   {  char ch;</font></tt></b>
<br><b><tt><font color="#000099">      cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">      if (cin.fail()) 
more = false;</font></tt></b>
<br><b><tt><font color="#000099">      else if
(isdigit(ch))  r = r + ch;</font></tt></b>
<br><b><tt><font color="#000099">      else</font></tt></b>
<br><b><tt><font color="#000099">      {</font></tt></b>
<br><b><tt><font color="#000099">#ifndef CCC_USE_OLD_STREAMS</font></tt></b>
<br><b><tt><font color="#000099">        
cin.unget();</font></tt></b>
<br><b><tt><font color="#000099">#else</font></tt></b>
<br><b><tt><font color="#000099">        
cin.putback(ch);</font></tt></b>
<br><b><tt><font color="#000099">/* used if your compiler doesn't support
the ANSI unget function */</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
<br><b><tt><font color="#000099">        
more = false;</font></tt></b>
<br><b><tt><font color="#000099">      }</font></tt></b>
<br><b><tt><font color="#000099"> }</font></tt></b>
<br><b><tt><font color="#000099">   return r;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string next_token()</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099">   skip_whitespace();</font></tt></b>
<br><b><tt><font color="#000099">   char ch;</font></tt></b>
<br><b><tt><font color="#000099">   cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">   if (cin.fail()) return "";</font></tt></b>
<br><b><tt><font color="#000099">   if (isdigit(ch))</font></tt></b>
<br><b><tt><font color="#000099">   {</font></tt></b>
<br><b><tt><font color="#000099">#ifndef CCC_USE_OLD_STREAMS</font></tt></b>
<br><b><tt><font color="#000099">      cin.unget();</font></tt></b>
<br><b><tt><font color="#000099">#else</font></tt></b>
<br><b><tt><font color="#000099">      cin.putback(ch);</font></tt></b>
<br><b><tt><font color="#000099">        
/* used if your compiler doesn't support the ANSI unget function */</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
<br><b><tt><font color="#000099">      return
next_number();</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099"> else</font></tt></b>
<br><b><tt><font color="#000099">   {  string token;</font></tt></b>
<br><b><tt><font color="#000099">      token =
token + ch;</font></tt></b>
<br><b><tt><font color="#000099">      if (is_operator(token)
or token == "(" or token == ")"</font></tt></b>
<br><b><tt><font color="#000099">           
or token == "=") return token;</font></tt></b>
<br><b><tt><font color="#000099">      else</font></tt></b>
<br><b><tt><font color="#000099">      { 
string message = "Unexpected input ";</font></tt></b>
<br><b><tt><font color="#000099">        
error(message + ch);</font></tt></b>
<br><b><tt><font color="#000099">        
return "";</font></tt></b>
<br><b><tt><font color="#000099">      }</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#993300">// calc.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "input.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "eval.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{</font></tt></b>
<br><b><tt><font color="#000099"> Stack numstack;</font></tt></b>
<br><b><tt><font color="#000099"> Stack opstack;</font></tt></b>
</p>
<p><b><tt><font color="#000099"> while (true)</font></tt></b>
<br><b><tt><font color="#000099"> {  string s = next_token();</font></tt></b>
<br><b><tt><font color="#000099">  if (is_operator(s))</font></tt></b>
<br><b><tt><font color="#000099">  {  if (opstack.is_empty())
opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">     else</font></tt></b>
<br><b><tt><font color="#000099">   {  string old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">    if (precedence(s) &gt;
precedence(old_op))  stack.push(old_op);</font></tt></b>
<br><b><tt><font color="#000099">    else</font></tt></b>
<br><b><tt><font color="#000099">     evaluate(numstack,
old_op);</font></tt></b>
<br><b><tt><font color="#000099">    opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == "(") opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == ")")</font></tt></b>
<br><b><tt><font color="#000099">  {  bool more = true;</font></tt></b>
<br><b><tt><font color="#000099">   while (more)</font></tt></b>
<br><b><tt><font color="#000099">   {  if (opstack.is_empty())
error("No matching (");</font></tt></b>
<br><b><tt><font color="#000099">    string old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">    if (old_op == "(")
more = false;</font></tt></b>
<br><b><tt><font color="#000099">    else evaluate(numstack,
old_op);</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == "=")</font></tt></b>
<br><b><tt><font color="#000099">  {  while (not opstack.is_empty())</font></tt></b>
<br><b><tt><font color="#000099">   {  string old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">    if (old_op == "(")
error("No matching )");</font></tt></b>
<br><b><tt><font color="#000099">    else evaluate(numstack,
old_op);</font></tt></b>
<br><b><tt><font color="#000099">   }</font></tt></b>
<br><b><tt><font color="#000099">   if (numstack.is_empty())
error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">   cout &lt;&lt; numstack.pop()
&lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">   if (not numstack.is_empty())
error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == "") /* end of input
*/</font></tt></b>
<br><b><tt><font color="#000099">        
return 0;</font></tt></b>
<br><b><tt><font color="#000099">  else /* must be a number */</font></tt></b>
<br><b><tt><font color="#000099">   numstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099"> }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><img src="bullet.gif" height="18" width="20" align="ABSCENTER"> Поделяне на
променливи между модули
<br> 
</p>
<p><img src="bullet.gif" height="18" width="20" align="ABSCENTER"> Проекти
<br> 
</p>
<p>
</p>
<hr width="100%">
</body>
</html>
