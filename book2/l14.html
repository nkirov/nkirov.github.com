<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
   <meta name="Author" content="Nikolay Kirov">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U) [Netscape]">
   <title>l14</title>
</head>
<body>

<center>
<h3>
<b><font size=+1>14. Потоци</font></b></h3></center>

<div align=right><i>Персеиди - силен метеорен поток</i>
<br><i>с радиант в съзвездието Персей.</i>
<br><i>Астрономически речник</i></div>

<p><br><img SRC="bullet.gif" height=18 width=20> Четене и запис в текстови
файлове.
<br>** Досега за четене от и запис във файлове (вж 9. Цикли) - чрез пренасочване
на стандартните вход и/или изход със средствата на операционната система
<br>** В заглавния файл <b><tt><font color="#000000">fstream</font></tt></b>
са дефинирани обекти, функции и операции за работа с файлове.
<br>А) Четене от файл.
<br>* дефиниране на файлова променлива за четене - обект от класа <b><tt><font color="#006600">ifstream:</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp;&nbsp; ifstream inp_data;</font></tt></b>
<br>* отваряне на файл от текущата директория с име <b><tt><font color="#006600">input.dat:</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp;&nbsp; inp_data.open("input.dat");</font></tt></b>
<br>* четене от файл на:
<br>&nbsp;- цели числа и числа с плаваща точка
<br><b><tt><font color="#006600">&nbsp;&nbsp; int n;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; double x;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; inp_data >> n >> x;</font></tt></b>
<br>&nbsp;- низове
<br><b><tt><font color="#006600">&nbsp;&nbsp; string s;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; inp_data >> s;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
// чете до разделител</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; getline(inp_data, s); //
чете цял ред</font></tt></b>
<br>&nbsp;- символи
<br><b><tt><font color="#006600">&nbsp;&nbsp; char ch;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; inp_data.get(ch);&nbsp;&nbsp;&nbsp;
// чете един символ</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; inp_data.unget();&nbsp;&nbsp;&nbsp;
// връща последния прочетен символ в буфера</font></tt></b>
<br>* затваряне на файл
<br><b><tt><font color="#006600">&nbsp;&nbsp; inp_data.close();</font></tt></b>
<p>&nbsp;&nbsp;&nbsp; Пример на цяла програма.
<br><b><tt><font color="#000099">// readf.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;fstream>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* включване на заглавен файл */</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{&nbsp; ifstream in_data; /* дефиниране
на файлова променлива за четене */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; in_data.open("readf.txt");&nbsp;
/* отваряне на файла readf.txt */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; string s1, s2;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; getline(in_data, s1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* четене на ред */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; in_data >> s2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* четене на дума */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; int n;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; double x;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; in_data >> n >> x;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* четене на числови данни */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; char ch;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; while (!in_data.eof())</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; in_data.get(ch);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* четене на символ */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; in_data.close();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* затваряне на файла */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; cout &lt;&lt; s1 &lt;&lt;
endl &lt;&lt; s2 &lt;&lt; " "</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&lt;&lt; n &lt;&lt; " " &lt;&lt; x &lt;&lt; " " &lt;&lt; ch &lt;&lt; endl;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><font color="#000000">Файл </font><b><tt><font color="#000099">readf.txt:</font></tt></b>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#000000">many happy words</font></tt></b>
<br><b><tt><font color="#000000">one_word&nbsp; 123&nbsp; 9.98&nbsp; N</font></tt></b></td>
</tr>
</table>

<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#993300">many happy words</font></tt></b>
<br><b><tt><font color="#993300">one_word&nbsp; 123&nbsp; 9.98&nbsp; N</font></tt></b></td>
</tr>
</table>

<p>Б) Писане във файл.
<br>* дефиниране на файлова променлива за писане - обект от класа <b><tt><font color="#006600">ofstream:</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; ofstream out_data;</font></tt></b>
<br>* отваряне на файл
<br><b><tt><font color="#006600">&nbsp;&nbsp; out_data.open("output.dat");</font></tt></b>
<br>* писане във&nbsp; файл с:
<br>&nbsp;- изходен поток
<br><b><tt><font color="#006600">&nbsp;&nbsp; int n = 2;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; double x = 1.5;</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; string s = " Hello";</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; out_data &lt;&lt; n &lt;&lt;
"&nbsp; " &lt;&lt; x &lt;&lt; s;</font></tt></b>
<br>&nbsp;- член-функция
<br><b><tt><font color="#006600">&nbsp;&nbsp; char ch = 'A';</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; out_data.put(ch);</font></tt></b>
<br>* затваряне на файл
<br><b><tt><font color="#006600">&nbsp;&nbsp; out_data.close();</font></tt></b>
<p>&nbsp;&nbsp;&nbsp; Пример на цяла програма.
<br><b><tt><font color="#000099">// writef.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;fstream>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* включване на заглавен файл */</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{&nbsp; ofstream out_data; /* дефиниране
на файлова променлива за писане */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; out_data.open("writef.txt");&nbsp;
/* отваряне на файла writef.txt */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; string s = "Hello";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; out_data &lt;&lt; s &lt;&lt;
endl; /* писане на низ */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; int n = 5;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; double x = 5.5;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; out_data &lt;&lt; n &lt;&lt;
" " &lt;&lt; x &lt;&lt; " "; /* писане на числови данни */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; char ch = 'T';</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; out_data.put(ch); /* писане
на символ */</font></tt></b>
<p><b><tt><font color="#000099">&nbsp;&nbsp; out_data.close();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* затваряне на файла */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><font color="#000000">Файл <b><tt>writef.txt:</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#000000">Hello</font></tt></b>
<br><b><tt><font color="#000000">5 5.5 T</font></tt></b></td>
</tr>
</table>

<p>В) Четене и писане във файл.
<br>* дефиниране на файлове променлива за четене и писане - обект от класа
<b><tt><font color="#006600">fstream:</font></tt></b>
<br><b><tt><font color="#006600">&nbsp;&nbsp; fstream io_data;</font></tt></b>
<br>* отваряне на файл, четене и писане - както са описани по-горе.
<p>* * Програма за четене на заплати и чертаене на диаграма.
<br><b><tt><font color="#000099">// readdata.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include "ccc_win.cpp"</font></tt></b>
<p><b><tt><font color="#000099">void read_data(vector&lt;double> &amp;v,
ifstream &amp;in)</font></tt></b>
<br><b><tt><font color="#000099">{ double s;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; while (in >> s) v.push_back(s);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">double maximum(vector&lt;double> v)</font></tt></b>
<br><b><tt><font color="#000099">{ if (v.size() == 0) return 0;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; double highest = v[0];</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; for (int i = 1; i &lt; v.size();
i++)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; if (v[i] > highest)
highest = v[i];</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return highest;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void plot_data(vector&lt;double> v)</font></tt></b>
<br><b><tt><font color="#000099">{ double highest = maximum(v);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; cwin.coord(0, 0, highest, v.size());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; for (int i = 0; i &lt; v.size();
i++)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { Point left(0, i);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; Point right(v[i], i);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; Line bar(left, right);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; Message label(left,
v[i]);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; cwin &lt;&lt; bar &lt;&lt;
label;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{ string filename</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; = cwin.get_string("Please
enter the data file name: ");</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; ifstream infile;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; infile.open(filename.c_str());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; vector&lt;double> data;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; read_data(data, infile);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; infile.close();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; plot_data(data);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<table WIDTH="100%" >
<tr>
<td VALIGN=TOP>
<br><img SRC="readda1.gif" height=34 width=435>
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<br>&nbsp;
<p>Файл <b><tt>readdata.txt</tt></b>:
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt>287 324 520 461 343</tt></b></td>
</tr>
</table>
</td>

<td><img SRC="readda2.gif" height=414 width=516></td>
</tr>
</table>

<hr WIDTH="100%">
<br><img SRC="bullet.gif" height=18 width=20> Низови (текстови) потоци.
<br>&nbsp;&nbsp;&nbsp; В езика С++ има възможност да се чете/пише от/в
низове вместо да се използват стандартни устройства или файлове. В заглавния
файл <b><tt><font color="#000000">sstream</font></tt></b> са дефинирани
обекти, функции и операции за работа с текстови потоци.
<br>* Входен поток - с обект от клас <b><tt><font color="#006600">istringstream.</font></tt></b>
<br><b><tt><font color="#006600">string input = "January 23, 1881";</font></tt></b>
<br><b><tt><font color="#006600">istringstream instr(input);</font></tt></b>
<br><b><tt><font color="#006600">string month;</font></tt></b>
<br><b><tt><font color="#006600">int day;</font></tt></b>
<br><b><tt><font color="#006600">string comma;</font></tt></b>
<br><b><tt><font color="#006600">int year;</font></tt></b>
<br><b><tt><font color="#006600">instr >> month >> day >> comma >> year;</font></tt></b>
<br>* Изходен поток - с обект от клас <b><tt><font color="#006600">ostringstream.</font></tt></b>
<br><b><tt><font color="#006600">ostringstream outstr;</font></tt></b>
<br><b><tt><font color="#006600">outstr &lt;&lt; setprecision(8) &lt;&lt;
sqrt(2);</font></tt></b>
<br><b><tt><font color="#006600">string output = outstr.str();</font></tt></b>
<p>Пример: Преобразуване на момент от време в низ.
<br><b><tt><font color="#000099">// readtime.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;sstream></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<p><b><tt><font color="#000099">string int_to_string(int n)</font></tt></b>
<br><b><tt><font color="#000099">{ ostringstream outstr;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; outstr &lt;&lt; n;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return outstr.str();</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void read_time(int &amp;hours, int &amp;minutes)</font></tt></b>
<br><b><tt><font color="#000099">{ string line;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; getline(cin, line);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; istringstream instr(line);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; instr >> hours;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; minutes = 0;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; char ch;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; instr.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (ch == ':') instr >> minutes;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
instr.unget();</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; string suffix;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; instr >> suffix;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (suffix == "pm") hours += 12;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">string time_to_string(int hours, int minutes,
bool am_pm)</font></tt></b>
<br><b><tt><font color="#000099">{ string suffix;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (am_pm)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { if (hours &lt; 12) suffix = "am";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; else { suffix = "pm";
hours -= 12; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; if (hours == 0) hours
= 12;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; string result = int_to_string(hours)
+ ":";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (minutes &lt; 10) result = result
+ "0";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; result = result + int_to_string(minutes);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (am_pm) result = result + "
" + suffix;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return result;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; "Please enter the time:
";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int hours, minutes;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; read_time(hours, minutes);</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; cout &lt;&lt; "Using am/pm:&nbsp;&nbsp;
" &lt;&lt; time_to_string(hours, minutes, true) &lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; cout &lt;&lt; "Military time: "
&lt;&lt; time_to_string(hours, minutes, false) &lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#993300">Please enter the time: 10:20 pm</font></tt></b>
<br><b><tt><font color="#993300">Using am/pm:&nbsp;&nbsp; 10:20 pm</font></tt></b>
<br><b><tt><font color="#993300">Military time: 22:20</font></tt></b></td>
</tr>
</table>

<p><img SRC="bullet.gif" height=18 width=20> Аргументи от командния ред.
<br>* Определение и използване.
<br>&nbsp;&nbsp;&nbsp; Операционните системи UNIX и DOS могат да предават
данни от командния ред за стартиране на програма на С и С++ на самата програма.
За тази цел главната функция <b><tt><font color="#000099">main</font></tt></b>
може да има два формални параметри - <b><tt><font color="#000099">int argc
</font></tt></b>и<b><tt><font color="#000099">
char* argv[]</font></tt><font color="#000000">.
</font></b><font color="#000000">Следващият
пример илюстрира тази възможност.</font>
<br><b><tt><font color="#000099">// argum.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<p><b><tt><font color="#000099">int main(int argc, char * argv[])</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; argc &lt;&lt; endl;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* брой на аргументите */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; for (int i=0; i&lt;argc; i++)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { string s = static_cast&lt;string>(argv[i]);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; cout &lt;&lt; s &lt;&lt;
" ";&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* пореден аргумент */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; cout &lt;&lt; endl;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><font color="#000000">Изпълнение на програмата:</font>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#993300">d:\pub\book2\cpp></font><font color="#006600">argum
-a b cc d</font></tt></b>
<br><b><tt><font color="#993300">5</font></tt></b>
<br><b><tt><font color="#993300">D:\PUB\BOOK2\CPP\ARGUM.EXE -a b cc d&nbsp;</font></tt></b></td>
</tr>
</table>

<p>* Шифър на Цезар.
<br>&nbsp;&nbsp;&nbsp; Шифрирането се състои в замяна на буква от даден
(изходен) текст с друга буква, която се намира е след <b><tt>key</tt></b>
букви в азбуката. Дешифрирането на шифриран текст се състои във възстановяване
на изходното съобщение.
<br>&nbsp;&nbsp;&nbsp; Програмта работи със следните аргументи от командния
ред:
<br>- флаг <b><tt>-d</tt></b> (незадължителен) за работа на програмата
по дешифриране;
<br>- флаг <b><tt>-k&lt;число> </tt></b>(незадължителен) за задаване на
ключ (по подразбиране ключът е 3);
<br>- име на входен файл;
<br>- име на изходен файл.
<p><b><tt><font color="#000099">// ceasar.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;fstream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;sstream></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<p><b><tt><font color="#000099">void usage(string program_name)</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; "Usage: " &lt;&lt; program_name</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt;
" [-d] [-kn] infile outfile\n";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; exit(1);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void open_file_error(string filename)</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; "Error opening file "
&lt;&lt; filename &lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; exit(1);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int remainder(int a, int n)</font></tt></b>
<br><b><tt><font color="#000099">{ if (a >= 0) return a % n;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
return n - 1 - (-a - 1) % n;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">char encrypt(char ch, int k)</font></tt></b>
<br><b><tt><font color="#000099">{ const int NLETTER = 26;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if ('A' &lt;= ch &amp;&amp; ch
&lt;= 'Z')</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; return static_cast&lt;char>('A'
+ remainder(ch-'A'+k, NLETTER));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if ('a' &lt;= ch &amp;&amp; ch
&lt;= 'z')</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; return static_cast&lt;char>('a'
+ remainder(ch-'a'+k, NLETTER));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return ch;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void encrypt_file(ifstream&amp; in, ofstream&amp;
out, int k)</font></tt></b>
<br><b><tt><font color="#000099">{ char ch;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; while (in.get(ch)) out.put(encrypt(ch,
k));</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int string_to_int(string s)</font></tt></b>
<br><b><tt><font color="#000099">{ istringstream instr(s);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int n;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; instr >> n;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return n;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int main(int argc, char* argv[])</font></tt></b>
<br><b><tt><font color="#000099">{ bool decrypt = false;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int key = 3;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int nfile = 0;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; ifstream infile;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; ofstream outfile;</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; if (argc&lt;3 or argc>5) usage(string(argv[0]));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; for (int i = 1; i &lt; argc; i++)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { string arg = string(argv[i]);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; if (arg.length() >=
2 and arg[0] == '-')</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; { char option = arg[1];</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (option
== 'd') decrypt = true;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if
(option == 'k')</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
key = string_to_int(arg.substr(2, arg.length() - 2));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; else</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; { nfile++;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (nfile
== 1)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { infile.open(arg.c_str());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if (infile.fail()) open_file_error(arg);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; else if
(nfile == 2)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { outfile.open(arg.c_str());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
if (outfile.fail()) open_file_error(arg);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; if(nfile != 2) usage(string(argv[0]));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; if (decrypt) key = -key;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; encrypt_file(infile, outfile,
key);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; infile.close();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; outfile.close();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><font color="#000000">Изпълнение на програмата:</font>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#990000">>ceasar</font></tt></b>
<br><b><tt><font color="#990000">></font><font color="#000099">Usage: CEASAR.EXE
[-d] [-kn] infile outfile</font></tt></b></td>
</tr>
</table>

<p><font color="#000000">Файл <b><tt>input.txt:</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#993366">This is a text to encrypt (1-st) and decrypt
(2-nd).</font></tt></b>
<br><b><tt><font color="#993366">One more line. End.</font></tt></b></td>
</tr>
</table>

<p><font color="#000000">Изпълнение на програмата:</font>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#990000">>ceasar input.txt encrypt1.txt</font></tt></b></td>
</tr>
</table>
<font color="#000000">Файл <b><tt>encrypt1.txt</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#993366">Wklv lv d whaw wr hqfubsw (1-vw) dqg ghfubsw
(2-qg).</font></tt></b>
<br><b><tt><font color="#993366">Rqh pruh olqh. Hqg.</font></tt></b></td>
</tr>
</table>

<p><font color="#000000">Изпълнение на програмата:</font>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#990000">>ceasar -k7 input.txt encrypt2.txt</font></tt></b></td>
</tr>
</table>
<font color="#000000">Файл <b><tt>encrypt2.txt</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#993366">Aopz pz h alea av lujyfwa (1-za) huk kljyfwa
(2-uk).</font></tt></b>
<br><b><tt><font color="#993366">Vul tvyl spul. Luk.</font></tt></b></td>
</tr>
</table>

<p><font color="#000000">Изпълнение на програмата:</font>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#990000">>ceasar -d -k7 encrypt2.txt output.txt</font></tt></b></td>
</tr>
</table>
<font color="#000000">Файл <b><tt>output.txt</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#993366">This is a text to encrypt (1-st) and decrypt
(2-nd).</font></tt></b>
<br><b><tt><font color="#993366">One more line. End.</font></tt></b></td>
</tr>
</table>

<p>
<hr WIDTH="100%">
<br><img SRC="bullet.gif" height=18 width=20> Произволен (пряк) достъп.
<br>- файлове с променлива или фиксирана дължина на записа:
<br><b><tt></tt></b>&nbsp;
<table BORDER CELLSPACING=0 CELLPADDING=2 >
<tr>
<td><b><tt><font color="#000000">Harry Hacker 500</font></tt></b></td>

<td><b><tt><font color="#000000">Johny Johnson 600</font></tt></b></td>

<td><b><tt><font color="#000000">Tedy Tompson 700.20</font></tt></b></td>
</tr>

<tr>
<td><b><tt>1234567890123456</tt></b></td>

<td><b><tt>12345678901234567</tt></b></td>

<td><b><tt>1234567890123456789</tt></b></td>
</tr>
</table>
<b><tt></tt></b>
<br><b><tt></tt></b>&nbsp;
<table BORDER CELLSPACING=0 CELLPADDING=2 >
<tr>
<td><b><tt><font color="#000000">Harry Hacker&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
500</font></tt></b></td>

<td><b><tt><font color="#000000">Johny Johnson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
600</font></tt></b></td>

<td><b><tt><font color="#000000">Tedy Tompson&nbsp;&nbsp;&nbsp; 700.20</font></tt></b></td>
</tr>

<tr>
<td><b><tt>1234567890123456789012</tt></b></td>

<td><b><tt>1234567890123456789012</tt></b></td>

<td><b><tt>1234567890123456789012</tt></b></td>
</tr>
</table>

<p>- <font color="#000000">включване на заглавен файл:</font>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; #include &lt;fstream></font></tt></b>
<br>- дефиниране на файлова променлива за четене и писане:
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; fstream fs;</font></tt></b>
<br>- преместване на позициите за четене и писане:
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; long n = 10;</font></tt></b>
<br><b><tt><font color="#009900">/* преместване на позицията за четене
10 байта след началото на файла */</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; fs.seekg(n, ios::beg);</font></tt></b>
<br><b><tt><font color="#009900">/* преместване на позицията за писане
10 байта след началото на файла */</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; fs.seekp(n, ios::beg);</font></tt></b>
<br><b><tt><font color="#009900">/* преместване на позицията за писане
в края на файла */</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; fs.seekp(n, ios::end);</font></tt></b>
<br><b><tt><font color="#009900">/* преместване на позицията за писане
10 байта напред относно текущата позиция */</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; fs.seekp(n, ios::cur);</font></tt></b>
<br>- намиране на текущите позициите за четене и писане:
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; long n;</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; n = fs.tellg();</font></tt></b>
<br><b><tt><font color="#009900">&nbsp;&nbsp;&nbsp; n = fs.tellp();</font></tt></b>
<p>* Програма за четене на файлови записи, съдържащи име на служител и
заплата и промяна на заплатата на даден служител.
<br><b><tt><font color="#000099">// database.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iomanip></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;fstream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;sstream></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">#include "ccc_empl.cpp"</font></tt></b>
<p><b><tt><font color="#000099">const int NEWLINE_LENGTH = 2; /* или 1
за Unix */</font></tt></b>
<br><b><tt><font color="#000099">const int RECORD_SIZE = 30 + 10 + NEWLINE_LENGTH;</font></tt></b>
<p><b><tt><font color="#000099">double string_to_double(string s)</font></tt></b>
<br><b><tt><font color="#000099">{ istringstream instr(s);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; double x;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; instr >> x;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return x;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void raise_salary(Employee &amp;e, double
percent)</font></tt></b>
<br><b><tt><font color="#000099">{ double new_salary = e.get_salary()*(1
+ percent/100);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; e.set_salary(new_salary);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void read_employee(Employee &amp;e, fstream
&amp;fs)</font></tt></b>
<br><b><tt><font color="#000099">{ string line;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; getline(fs, line);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (fs.fail()) return;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; string name = line.substr(0, 30);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; double salary = string_to_double(line.substr(30,
10));</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; e = Employee(name, salary);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void write_employee(Employee e, fstream
&amp;fs)</font></tt></b>
<br><b><tt><font color="#000099">{ fs &lt;&lt; e.get_name()</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; setw(10
+ (30 - e.get_name().length()))</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; fixed
&lt;&lt; setprecision(2)</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt; e.get_salary()
&lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; "Please enter the data
file name: ";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; string filename;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; cin >> filename;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; fstream fs;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; fs.open(filename.c_str());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; fs.seekg(0, ios::end);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int nrecord = fs.tellg()/RECORD_SIZE;</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; cout &lt;&lt; "Please enter the
record to update: (0 - "</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;&lt;
nrecord - 1 &lt;&lt; ") ";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; int pos;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; cin >> pos;</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; const double SALARY_CHANGE = 5.0;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Employee e;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; fs.seekg(pos*RECORD_SIZE, ios::beg);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; read_employee(e, fs);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; raise_salary(e, SALARY_CHANGE);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; fs.seekp(pos*RECORD_SIZE, ios::beg);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; write_employee(e, fs);</font></tt></b>
<p><b><tt><font color="#000099">&nbsp; fs.close();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><font color="#000000">Файл <b><tt>data.txt </tt></b>преди изпълнение
на програмата<b><tt>:</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#000000">Harry Hacker&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
500</font></tt></b>
<br><b><tt><font color="#000000">Johny Johnson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
600</font></tt></b>
<br><b><tt><font color="#000000">Tedy Tompson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
777</font></tt></b></td>
</tr>
</table>

<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#993300">Please enter the data file name: data.txt</font></tt></b>
<br><b><tt><font color="#993300">Please enter the record to update: (0
- 2) 1</font></tt></b></td>
</tr>
</table>
<font color="#000000">Файл <b><tt>data.txt </tt></b>след изпълнение на
програмата<b><tt>:</tt></b></font>
<table BORDER CELLPADDING=4 BGCOLOR="#CCCCCC" >
<tr>
<td><b><tt><font color="#000000">Harry Hacker&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
500</font></tt></b>
<br><b><tt><font color="#000000">Johny Johnson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
630.00</font></tt></b>
<br><b><tt><font color="#000000">Tedy Tompson&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
777</font></tt></b></td>
</tr>
</table>

<p>
<hr WIDTH="100%">
</body>
</html>
