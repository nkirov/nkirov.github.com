<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <meta name="Author" content="Nikolay Kirov">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U) [Netscape]">
   <title>l15</title>
</head>
<body>

<center>
<h3>
<b><font size="+1"> 15. Модули</font></b>
</h3>
</center>

<div align="right">
<i>Програмата е съвкупност от отделно</i>
<br><i>компилирани единици, свързани от линкера.</i>
<br><i>Бьорн Строустроп</i>
</div>

<p><br><img src="bullet.gif" height="18" width="20"> Създаване на заглавни
файлове.
<br>* Стекът е линейна структура от данни, която позволява добавяне и отстраняване
на елемент само от единия си край, наречен връх на стека. Нека функцията
<b><tt><font color="#CC6600">push</font></tt></b>
добавя елемент в стека
<b><tt><font color="#CC6600">s</font></tt></b>,
а функцията <b><tt><font color="#CC6600">pop</font></tt></b> изважда елемент
от стека <b><tt><font color="#CC6600">s</font></tt></b>.
<br> 
</p>
<table border cellspacing="0" cellpadding="4">
<tr>
<td><font color="#000000"> Изпълнение на функция</font></td>

<td>Състояние на стека <b><tt><font color="#CC6600">s</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.push("Able")</font></tt></b></td>

<td><b><tt><font color="#CC6600">"Able"</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.push("Backer")</font></tt></b></td>

<td>
<b><tt><font color="#CC6600">"Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">"Able"</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.push("Charlie")</font></tt></b></td>

<td>
<b><tt><font color="#CC6600">"Charlie"</font></tt></b>
<br><b><tt><font color="#CC6600">"Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">"Able"</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.pop() -&gt; "Charlie"</font></tt></b></td>

<td>
<b><tt><font color="#CC6600">"Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">"Able"</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.push("Delta")</font></tt></b></td>

<td>
<b><tt><font color="#CC6600">"Delta"</font></tt></b>
<br><b><tt><font color="#CC6600">"Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">"Able"</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.pop() -&gt; "Delta"</font></tt></b></td>

<td>
<b><tt><font color="#CC6600">"Backer"</font></tt></b>
<br><b><tt><font color="#CC6600">"Able"</font></tt></b>
</td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.pop() -&gt; "Backer"</font></tt></b></td>

<td><b><tt><font color="#CC6600">"Able"</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#CC6600">s.pop() -&gt; "Able"</font></tt></b></td>

<td></td>
</tr>
</table>

<p>* Създаване на клас за стек от низове.
<br><b><tt><font color="#006600">class Stack  {</font></tt></b>
<br><b><tt><font color="#006600">public:</font></tt></b>
<br><b><tt><font color="#006600"> Stack();</font></tt></b>
<br><b><tt><font color="#006600"> void push(string s); /* добавя нова
стойност в стека */</font></tt></b>
<br><b><tt><font color="#006600"> string pop();       
/* изважда стойност от стека */</font></tt></b>
<br><b><tt><font color="#006600"> bool is_empty() const;</font></tt></b>
<br><b><tt><font color="#006600">private:</font></tt></b>
<br><b><tt><font color="#006600"> vector&lt;string&gt; data; /* съхранява
данните на стека */</font></tt></b>
<br><b><tt><font color="#006600"> int top;            
/* сочи върха на стека */</font></tt></b>
<br><b><tt><font color="#006600">};</font></tt></b>
</p>
<p><b><tt><font color="#006600">Stack::Stack()</font></tt></b>
<br><b><tt><font color="#006600">{ top = 0; }         
/* създава празен стек */</font></tt></b>
</p>
<p><b><tt><font color="#006600">void Stack::push(string s)</font></tt></b>
<br><b><tt><font color="#006600">{ if (top &lt; data.size())</font></tt></b>
<br><b><tt><font color="#006600">       data[top]
= s;     /* има празна позиция във вектора data */</font></tt></b>
<br><b><tt><font color="#006600">  else data.push_back(s); /* векторът
data увеличава размера си  */</font></tt></b>
<br><b><tt><font color="#006600">  top++;</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><b><tt><font color="#006600">string Stack::pop()</font></tt></b>
<br><b><tt><font color="#006600">{ assert(top &gt; 0);      
/* стекът не е празен */</font></tt></b>
<br><b><tt><font color="#006600">  top--;</font></tt></b>
<br><b><tt><font color="#006600">  return data[top];</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><b><tt><font color="#006600">bool Stack::is_empty() const</font></tt></b>
<br><b><tt><font color="#006600">{ return top == 0; }</font></tt></b>
</p>
<p>* Разделяне на информацията между <b><tt><font color="#006600">stack.h</font></tt></b>
и <b><tt><font color="#006600">stack.cpp</font></tt></b>.
<br>    Заглавният файл
<b><tt><font color="#006600">stack.h</font></tt></b>
съдържа дефиницията на класа и се включва във всеки файл, който използва
стек.
<br><b><tt><font color="#006600">// </font><font color="#993300">stack.h</font></tt></b>
<br><b><tt><font color="#006600">#ifndef STACK_H</font></tt></b>
<br><b><tt><font color="#006600">#define STACK_H</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;vector&gt;</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#006600">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#006600">class Stack  {</font></tt></b>
<br><b><tt><font color="#006600">public:</font></tt></b>
<br><b><tt><font color="#006600"> Stack();</font></tt></b>
<br><b><tt><font color="#006600"> void push(string );</font></tt></b>
<br><b><tt><font color="#006600"> string pop();</font></tt></b>
<br><b><tt><font color="#006600"> bool is_empty() const;</font></tt></b>
<br><b><tt><font color="#006600">private:</font></tt></b>
<br><b><tt><font color="#006600"> vector&lt;string&gt; data;</font></tt></b>
<br><b><tt><font color="#006600"> int top;</font></tt></b>
<br><b><tt><font color="#006600">};</font></tt></b>
<br><b><tt><font color="#006600">#endif</font></tt></b>
<br>    Може да се наложи един и същи заглавен файл да се
включи два пъти в текста на една програма - тогава компилаторът ще даде
синтактична грешка. За да се избегне тази ситуация се използва механизмът
на предпазителите - чрез директивите на препроцесора <b><tt><font color="#006600">ifndef</font></tt><font color="#000000">,
</font><tt><font color="#006600">define</font></tt></b>
и <b><tt><font color="#006600">endif</font></tt></b>, както е показано
на примера.
<br>    Дефинициите на член-функциите на класа <b><tt><font color="#006600">Stack</font></tt></b>
са във файл <b><tt><font color="#993300">stack.cpp</font></tt></b>.
<br><b><tt><font color="#006600">// </font><font color="#993300">stack.cpp</font></tt></b>
<br><b><tt><font color="#006600">#include &lt;cassert&gt;</font></tt></b>
<br><b><tt><font color="#006600">using namespace std;</font></tt></b>
<br><b><tt><font color="#006600">#include "stack.h"</font></tt></b>
</p>
<p><b><tt><font color="#006600">Stack::Stack()</font></tt></b>
<br><b><tt><font color="#006600">{ top = 0; }</font></tt></b>
</p>
<p><b><tt><font color="#006600">void Stack::push(string s)</font></tt></b>
<br><b><tt><font color="#006600">{ if (top &lt; data.size()) data[top]
= s;</font></tt></b>
<br><b><tt><font color="#006600">  else data.push_back(s);</font></tt></b>
<br><b><tt><font color="#006600">  top++;</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
</p>
<p><b><tt><font color="#006600">string Stack::pop()</font></tt></b>
<br><b><tt><font color="#006600">{ assert(top &gt; 0);</font></tt></b>
<br><b><tt><font color="#006600">  top--;</font></tt></b>
<br><b><tt><font color="#006600">  return data[top];</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
</p>
<p><b><tt><font color="#006600">bool Stack::is_empty() const</font></tt></b>
<br><b><tt><font color="#006600">{ return top == 0; }</font></tt></b>
<br><b><tt><font color="#006600">// end </font><font color="#993300">stack.cpp</font></tt></b>
<br>
</p>
<hr width="100%">
<br><img src="bullet.gif" height="18" width="20"> Разделяне на програмата на
няколко първични файла.
<br>    Пример. Да се напише програма, която да може да
пресмята аритметични изрази.
<br>    Аритметичните изрази се пишат по правилата на езика
С++ за действия с числа с плаваща точка и се задават като низове от входа
на програмата. Добавена е операция степенуване "<b><tt>^</tt></b>". Например
при вход на низа
<center><b><tt>2*(1 + 2^2*3) + 2^10 =</tt></b></center>
програмата трябва да изведе числото <b><tt>1050</tt></b>.
<br>    Алгоритъм за решаване на задчата.
<br>    Създават се два стека - стек за числата - <b><tt>num_s</tt></b>
и стек за операциите - <b><tt>op_s</tt></b>. Четат се последователно елементи
от низа и в зависимост от прочетения елемент се прави следното:
<br>    1. Число - добавя се в <b><tt>num_s.</tt></b>
<br>    2. <b><tt>(</tt></b> - добавя се в <b><tt>op_s.</tt></b>
<br>    3. Аритметична операция - сравнява се приоритетът
й с приоритета на операцията от <b><tt>op_s</tt></b>.
<br>      - Ако е с по-висок приоритет се добавя
в <b><tt>op_s.</tt></b>
<br>      - В противен случай се извършва "пресмятане"
и след това операцията се добавя в <b><tt>op_s</tt></b>.
<br>    "Пресмятане" наричаме изваждане на две числа от
<b><tt>num_s</tt></b>
и една операция от <b><tt>op_s</tt></b>; изпълнение на операцията с аргументи
двете числа и добавяне на получения резултат в <b><tt>num_s</tt></b>.
<br>    4. <b><tt>)</tt></b> - извършват се "пресмятания",
докато в <b><tt>op_s</tt></b> се появи <b><tt>(</tt></b>.
<br>    5.<b><tt> =</tt></b> - извършват се "пресмятания",
докато има елементи в <b><tt>op_s</tt></b>.
<br>Когато стекът <b><tt>op_s</tt></b> е празен, в <b><tt>num_s</tt></b>
има единствено число - стойността на пресметнатия аритметичен израз.
<br>    В таблицата е реализиран описания алгоритъм за пресмятане
на израза
<br><b><tt>2*(1 + 2^2*3) + 2^10 =</tt></b>
<center><table border cellspacing="0" cellpadding="2" width="100%">
<tr align="CENTER" valign="CENTER">
<td>Елемент
<br>от низа</td>

<td><b><tt><font color="#000000">2</font></tt></b></td>

<td><b><tt><font color="#000000">*</font></tt></b></td>

<td><b><tt><font color="#000000">(</font></tt></b></td>

<td><b><tt><font color="#000000">1</font></tt></b></td>

<td><b><tt><font color="#000000">+</font></tt></b></td>

<td><b><tt><font color="#000000">2</font></tt></b></td>

<td><b><tt><font color="#000000">^</font></tt></b></td>

<td><b><tt><font color="#000000">2</font></tt></b></td>

<td><b><tt><font color="#000000">*</font></tt></b></td>

<td><b><tt><font color="#000000">3</font></tt></b></td>

<td><b><tt><font color="#000000">)</font></tt></b></td>

<td><b><tt><font color="#000000">+</font></tt></b></td>

<td><b><tt><font color="#000000">2</font></tt></b></td>

<td><b><tt><font color="#000000">^</font></tt></b></td>

<td><b><tt><font color="#000000">10</font></tt></b></td>

<td><b><tt><font color="#000000">=</font></tt></b></td>
</tr>

<tr>
<td align="CENTER" valign="CENTER">"пресмятане"</td>

<td></td>

<td></td>

<td></td>

<td></td>

<td></td>

<td></td>

<td></td>

<td></td>

<td>
<b><tt><font color="#000000">2^2</font></tt></b>
<br><b><tt><font color="#000000">=4</font></tt></b>
</td>

<td></td>

<td>
<b><tt><font color="#000000">4*3</font></tt></b>
<br><b><tt><font color="#000000">=12</font></tt></b>
<br><b><tt><font color="#000000">1+12</font></tt></b>
<br><b><tt><font color="#000000">=13</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">2*13</font></tt></b>
<br><b><tt><font color="#000000">=26</font></tt></b>
</td>

<td></td>

<td></td>

<td></td>

<td>
<b><tt><font color="#000000">2^10</font></tt></b>
<br><b><tt><font color="#000000">=1024</font></tt></b>
<br><b><tt><font color="#000000">26+1024</font></tt></b>
<br><b><tt><font color="#000000">=1050</font></tt></b>
</td>
</tr>

<tr>
<td align="CENTER" valign="CENTER"><b><tt><font color="#000000">num_s</font></tt></b></td>

<td valign="TOP"><b><tt><font color="#000000">2</font></tt></b></td>

<td valign="TOP"><b><tt><font color="#000000">2</font></tt></b></td>

<td valign="TOP"><b><tt><font color="#000000">2</font></tt></b></td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
<br><b><tt><font color="#000000">4</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">1</font></tt></b>
<br><b><tt><font color="#000000">4</font></tt></b>
<br><b><tt><font color="#000000">3</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">13</font></tt></b>
</td>

<td valign="TOP"><b><tt><font color="#000000">26</font></tt></b></td>

<td valign="TOP">
<b><tt><font color="#000000">26</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">26</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">26</font></tt></b>
<br><b><tt><font color="#000000">2</font></tt></b>
<br><b><tt><font color="#000000">10</font></tt></b>
</td>

<td valign="TOP"><b><tt><font color="#000000">1050</font></tt></b></td>
</tr>

<tr>
<td align="CENTER" valign="CENTER"><b><tt><font color="#000000">op_s</font></tt></b></td>

<td></td>

<td valign="TOP"><b><tt><font color="#000000">*</font></tt></b></td>

<td valign="TOP">
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
</td>

<td valign="TOP">
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
<br><b><tt><font color="#000000">^</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
<br><b><tt><font color="#000000">^</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
<br><b><tt><font color="#000000">*</font></tt></b>
</td>

<td>
<b><tt><font color="#000000">*</font></tt></b>
<br><b><tt><font color="#000000">(</font></tt></b>
<br><b><tt><font color="#000000">+</font></tt></b>
<br><b><tt><font color="#000000">*</font></tt></b>
</td>

<td valign="TOP"><b><tt>* </tt></b></td>

<td valign="TOP"><b><tt>+</tt></b></td>

<td valign="TOP"><b><tt>+</tt></b></td>

<td valign="TOP">
<b><tt>+</tt></b>
<br><b><tt>^</tt></b>
</td>

<td valign="TOP">
<b><tt>+</tt></b>
<br><b><tt>^</tt></b>
</td>

<td></td>
</tr>
</table></center>

<p>Текстът на програмата за пресмятане на аритметични изрази е разделен
на няколко файла, връзките между които са описани в следната таблица:
<br> 
</p>
<table border cellspacing="0" cellpadding="4" width="100%">
<tr>
<td>Файл (модул)</td>

<td><b><tt>#include</tt></b></td>

<td>компилация</td>
</tr>

<tr>
<td><b><tt><font color="#000099">stack.h</font></tt></b></td>

<td>-</td>

<td>-</td>
</tr>

<tr>
<td><b><tt><font color="#000099">stack.cpp</font></tt></b></td>

<td><b><tt><font color="#000099">stack.h</font></tt></b></td>

<td><b><tt><font color="#000099">stack.obj</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#993300">error.h</font></tt></b></td>

<td>-</td>

<td>-</td>
</tr>

<tr>
<td><b><tt><font color="#993300">error.cpp</font></tt></b></td>

<td><b><tt><font color="#993300">error.h</font></tt></b></td>

<td><b><tt><font color="#993300">error.obj</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#993300">input.h</font></tt></b></td>

<td>-</td>

<td>-</td>
</tr>

<tr>
<td><b><tt><font color="#993300">input.cpp</font></tt></b></td>

<td>
<b><tt><font color="#993300">error.h</font></tt></b>
<br><b><tt><font color="#993300">input.h</font></tt></b>
</td>

<td><b><tt><font color="#993300">input.obj</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#993300">eval.h</font></tt></b></td>

<td><b><tt><font color="#000099">stack.h</font></tt></b></td>

<td>-</td>
</tr>

<tr>
<td><b><tt><font color="#993300">eval.cpp</font></tt></b></td>

<td>
<b><tt><font color="#000099">stack.h</font></tt></b>
<br><b><tt><font color="#993300">error.h</font></tt></b>
<br><b><tt><font color="#993300">eval.h</font></tt></b>
</td>

<td><b><tt><font color="#993300">eval.obj</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#993300">calc.cpp</font></tt></b></td>

<td>
<b><tt><font color="#000099">stack.h</font></tt></b>
<br><b><tt><font color="#000099">input.h</font></tt></b>
<br><b><tt><font color="#000099">eval.h</font></tt></b>
<br><b><tt><font color="#000099">error.h</font></tt></b>
</td>

<td><b><tt><font color="#993300">calc.exe</font></tt></b></td>
</tr>
</table>

<p><b><tt><font color="#993300">// error.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef ERROR_H</font></tt></b>
<br><b><tt><font color="#000099">#define ERROR_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">void error(string );</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// input.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef INPUT_H</font></tt></b>
<br><b><tt><font color="#000099">#define INPUT_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">bool is_operator(string);</font></tt></b>
<br><b><tt><font color="#000099">string next_token();</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// eval.h</font></tt></b>
<br><b><tt><font color="#000099">#ifndef EVAL_H</font></tt></b>
<br><b><tt><font color="#000099">#define EVAL_H</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<br><b><tt><font color="#000099">int precedence(string);</font></tt></b>
<br><b><tt><font color="#000099">void evaluate(Stack &amp;, string);</font></tt></b>
<br><b><tt><font color="#000099">#endif</font></tt></b>
</p>
<p><b><tt><font color="#993300">// error.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">void error(string message)</font></tt></b>
<br><b><tt><font color="#000099">{ cout &lt;&lt; "ERROR: " &lt;&lt; message
&lt;&lt; ".\n";</font></tt></b>
<br><b><tt><font color="#000099">  exit(1);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><b><tt><font color="#993300">// end error.cpp</font></tt></b>
</p>
<p><b><tt><font color="#993300">// eval.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;sstream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;cmath&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "eval.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">int precedence(string s)</font></tt></b>
<br><b><tt><font color="#000099">{ if (s == "+" or s == "-")     
return 1;</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == "*" or s == "/")
return 2;</font></tt></b>
<br><b><tt><font color="#000099">  else if (s == "^")            
return 3;</font></tt></b>
<br><b><tt><font color="#000099">  else                          
return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">double string_to_double(string s)</font></tt></b>
<br><b><tt><font color="#000099">{ istringstream instr(s);</font></tt></b>
<br><b><tt><font color="#000099">  double x;</font></tt></b>
<br><b><tt><font color="#000099">  instr &gt;&gt; x;</font></tt></b>
<br><b><tt><font color="#000099">  return x;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string double_to_string(double x)</font></tt></b>
<br><b><tt><font color="#000099">{ ostringstream outstr;</font></tt></b>
<br><b><tt><font color="#000099">  outstr &lt;&lt; x;</font></tt></b>
<br><b><tt><font color="#000099">  return outstr.str();</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">void evaluate(Stack &amp;num, string op)</font></tt></b>
<br><b><tt><font color="#000099">{ if (num.is_empty()) error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">  double y = string_to_double(num.pop());</font></tt></b>
<br><b><tt><font color="#000099">  if (num.is_empty()) error("Syntax
error");</font></tt></b>
<br><b><tt><font color="#000099">  double x = string_to_double(num.pop());</font></tt></b>
<br><b><tt><font color="#000099">  double z;</font></tt></b>
<br><b><tt><font color="#000099">  if (op == "^") z = pow(x, y);</font></tt></b>
<br><b><tt><font color="#000099">  else if (op == "*") z = x * y;</font></tt></b>
<br><b><tt><font color="#000099">  else if (op == "/")</font></tt></b>
<br><b><tt><font color="#000099">  { if (y == 0) error("Divide by
0");</font></tt></b>
<br><b><tt><font color="#000099">    else z = x / y;</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  else if (op == "+") z = x + y;</font></tt></b>
<br><b><tt><font color="#000099">  else if (op == "-") z = x - y;</font></tt></b>
<br><b><tt><font color="#000099">  else error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">  num.push(double_to_string(z));</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><b><tt><font color="#993300">// end eval.cpp</font></tt></b>
</p>
<p><b><tt><font color="#993300">// input.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;cctype&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "error.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "input.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">bool is_operator(string s)</font></tt></b>
<br><b><tt><font color="#000099">{ return s == "+" or s == "-" or</font></tt></b>
<br><b><tt><font color="#000099">        
s == "*" or s == "/" or s == "^";</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">void skip_whitespace()</font></tt></b>
<br><b><tt><font color="#000099">{ char ch;</font></tt></b>
<br><b><tt><font color="#000099">  do</font></tt></b>
<br><b><tt><font color="#000099">  { cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">    if (cin.fail()) return;</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  while (isspace(ch));</font></tt></b>
<br><b><tt><font color="#000099">  cin.unget();</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string next_number()</font></tt></b>
<br><b><tt><font color="#000099">{ string r;</font></tt></b>
<br><b><tt><font color="#000099">  bool more = true;</font></tt></b>
<br><b><tt><font color="#000099">  while (more)</font></tt></b>
<br><b><tt><font color="#000099">  { char ch;</font></tt></b>
<br><b><tt><font color="#000099">    cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">    if (cin.fail()) 
more = false;</font></tt></b>
<br><b><tt><font color="#000099">    else if (isdigit(ch))
r = r + ch;</font></tt></b>
<br><b><tt><font color="#000099">    else</font></tt></b>
<br><b><tt><font color="#000099">    { cin.unget();</font></tt></b>
<br><b><tt><font color="#000099">      more =
false;</font></tt></b>
<br><b><tt><font color="#000099">    }</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">  return r;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
</p>
<p><b><tt><font color="#000099">string next_token()</font></tt></b>
<br><b><tt><font color="#000099">{ skip_whitespace();</font></tt></b>
<br><b><tt><font color="#000099">  char ch;</font></tt></b>
<br><b><tt><font color="#000099">  cin.get(ch);</font></tt></b>
<br><b><tt><font color="#000099">  if (cin.fail()) return "";</font></tt></b>
<br><b><tt><font color="#000099">  if (isdigit(ch)) { cin.unget();
return next_number(); }</font></tt></b>
<br><b><tt><font color="#000099">  else</font></tt></b>
<br><b><tt><font color="#000099">  { string token;</font></tt></b>
<br><b><tt><font color="#000099">    token = token + ch;</font></tt></b>
<br><b><tt><font color="#000099">    if (is_operator(token)
or token == "(" or</font></tt></b>
<br><b><tt><font color="#000099">             
token == ")" or token == "=") return token;</font></tt></b>
<br><b><tt><font color="#000099">    else</font></tt></b>
<br><b><tt><font color="#000099">    { string message =
"Unexpected input ";</font></tt></b>
<br><b><tt><font color="#000099">      error(message
+ ch);</font></tt></b>
<br><b><tt><font color="#000099">      return
"";</font></tt></b>
<br><b><tt><font color="#000099">    }</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><b><tt><font color="#993300">// end input.cpp</font></tt></b>
</p>
<p><b><tt><font color="#993300">// calc.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream&gt;</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string&gt;</font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
</p>
<p><b><tt><font color="#000099">#include "stack.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "input.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "eval.h"</font></tt></b>
<br><b><tt><font color="#000099">#include "error.h"</font></tt></b>
</p>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{ Stack numstack;</font></tt></b>
<br><b><tt><font color="#000099">  Stack opstack;</font></tt></b>
</p>
<p><b><tt><font color="#000099">  while (true)</font></tt></b>
<br><b><tt><font color="#000099">  { string s = next_token();</font></tt></b>
<br><b><tt><font color="#000099">    if (is_operator(s))</font></tt></b>
<br><b><tt><font color="#000099">    { if (opstack.is_empty())
opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">      else</font></tt></b>
<br><b><tt><font color="#000099">      { string
old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">       
if (precedence(s) &gt; precedence(old_op)) opstack.push(old_op);</font></tt></b>
<br><b><tt><font color="#000099">       
else evaluate(numstack, old_op);</font></tt></b>
<br><b><tt><font color="#000099">       
opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">      }</font></tt></b>
<br><b><tt><font color="#000099">    }</font></tt></b>
<br><b><tt><font color="#000099">    else if (s == "(")
opstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">    else if (s == ")")</font></tt></b>
<br><b><tt><font color="#000099">    { bool more = true;</font></tt></b>
<br><b><tt><font color="#000099">      while (more)</font></tt></b>
<br><b><tt><font color="#000099">      { if (opstack.is_empty())
error("No matching (");</font></tt></b>
<br><b><tt><font color="#000099">       
string old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">       
if (old_op == "(") more = false;</font></tt></b>
<br><b><tt><font color="#000099">       
else evaluate(numstack, old_op);</font></tt></b>
<br><b><tt><font color="#000099">      }</font></tt></b>
<br><b><tt><font color="#000099">    }</font></tt></b>
<br><b><tt><font color="#000099">    else if (s == "=")</font></tt></b>
<br><b><tt><font color="#000099">    { while (not opstack.is_empty())</font></tt></b>
<br><b><tt><font color="#000099">      { string
old_op = opstack.pop();</font></tt></b>
<br><b><tt><font color="#000099">       
if (old_op == "(") error("No matching )");</font></tt></b>
<br><b><tt><font color="#000099">       
else evaluate(numstack, old_op);</font></tt></b>
<br><b><tt><font color="#000099">      }</font></tt></b>
<br><b><tt><font color="#000099">      if (numstack.is_empty())
error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">      cout &lt;&lt;
numstack.pop() &lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">      if (not
numstack.is_empty()) error("Syntax error");</font></tt></b>
<br><b><tt><font color="#000099">    }</font></tt></b>
<br><b><tt><font color="#000099">    else if (s == "") return
0;</font></tt></b>
<br><b><tt><font color="#000099">    else numstack.push(s);</font></tt></b>
<br><b><tt><font color="#000099">  }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<br><b><tt><font color="#993300">// end calc.cpp</font></tt></b>
<br> 
</p>
<table border cellpadding="4" width="100%">
<tr>
<td>
<b><tt><font color="#006600">2*(1 + 2^2*3) + 2^10 =</font></tt></b>
<br><b><tt><font color="#993300">1050</font></tt></b>
<br><b><tt><font color="#006600">(25/5 + 5)*10 - 4*(5 - 4/(2^2)) - 50 =</font></tt></b>
<br><b><tt><font color="#993300">34</font></tt></b>
</td>
</tr>
</table>

<p><img src="bullet.gif" height="18" width="20"> Проекти и <b><tt>make</tt></b>
файлове.
<br>    Когато програмата е разделена на няколко модула,
можем да компилираме всеки от тях отделно. Компилаторът създава обектни
файлове за всеки модул. Свързващата програма (<b><tt>link</tt></b>) обработва
всички модули и създава изпълним файл. В интегрирана среда за програмиране,
обединяването на файловете от една програма става със създаване на проекти.
<br>    Например в среда на <b><tt>Dev-C++</tt></b> трябва
да отворим нов проект и да добавим всички файлове от програмата. За програмата
за пресмятане на  аритметични изрази, това са файловете:
<br><b><tt>    calc.cpp</tt></b>
<br><b><tt>    stack.cpp</tt></b>
<br><b><tt>    error.cpp</tt></b>
<br><b><tt>    input.cpp</tt></b>
<br><b><tt>    eval.cpp</tt></b>
<br>    Самият проект се записва във файла <b><tt>project.dev.</tt></b>
<br>    Когато се работи с извикване на компилатора от командния
ред (извън интегрирана среда),  най-често се използва специален файл,
наречен make-файл. Той е текстов файл и описва модулите на програмата и
тяхното взаимодействие.
<br>    Например програманата среда <b><tt>Dev-C++</tt></b>
създава такъв файл и по-долу е даден този файл  за задачата за пресмятане
на аритметични изрази (операционна система Windows 98).
</p>
<p><b><tt>Makefile.win</tt></b>
</p>
<table border cellspacing="0" cellpadding="2" width="100%">
<tr>
<td>
<b><tt># Project: Project1</tt></b>
<br><b><tt># Makefile created by Dev-C++ 4.9.8.0</tt></b>
<p><b><tt>CPP  = g++.exe</tt></b>
<br><b><tt>CC   = gcc.exe</tt></b>
<br><b><tt>WINDRES = windres.exe</tt></b>
<br><b><tt>RES  = </tt></b>
<br><b><tt>OBJ  = calc.o stack.o input.o eval.o error.o $(RES)</tt></b>
<br><b><tt>LINKOBJ  = calc.o stack.o input.o eval.o error.o $(RES)</tt></b>
<br><b><tt>LIBS =  -L"C:/DEV-CPP/lib" </tt></b>
<br><b><tt>INCS =  -I"C:/DEV-CPP/include" </tt></b>
<br><b><tt>CXXINCS =  -I"C:/DEV-CPP/include/c++"  -I"C:/DEV-CPP/include/c++/mingw32" 
-I"C:/DEV-CPP/include/c++/backward"  -I"C:/DEV-CPP/include" 
-I"C:/ccc2book" </tt></b>
<br><b><tt>BIN  = Pro.exe</tt></b>
<br><b><tt>CXXFLAGS = $(CXXINCS) </tt></b>
<br><b><tt>CFLAGS = $(INCS) </tt></b>
</p>
<p><b><tt>.PHONY: all all-before all-after clean clean-custom</tt></b>
</p>
<p><b><tt>all: all-before Pro.exe all-after</tt></b>
</p>
<p><b><tt>clean: clean-custom</tt></b>
<br><b><tt> rm -f $(OBJ) $(BIN)</tt></b>
</p>
<p><b><tt>$(BIN): $(LINKOBJ)</tt></b>
<br><b><tt> $(CPP) $(LINKOBJ) -o "Pro.exe" $(LIBS)</tt></b>
</p>
<p><b><tt>calc.o: calc.cpp</tt></b>
<br><b><tt> $(CPP) -c calc.cpp -o calc.o $(CXXFLAGS)</tt></b>
</p>
<p><b><tt>stack.o: stack.cpp</tt></b>
<br><b><tt> $(CPP) -c stack.cpp -o stack.o $(CXXFLAGS)</tt></b>
</p>
<p><b><tt>input.o: input.cpp</tt></b>
<br><b><tt> $(CPP) -c input.cpp -o input.o $(CXXFLAGS)</tt></b>
</p>
<p><b><tt>eval.o: eval.cpp</tt></b>
<br><b><tt> $(CPP) -c eval.cpp -o eval.o $(CXXFLAGS)</tt></b>
</p>
<p><b><tt>error.o: error.cpp</tt></b>
<br><b><tt> $(CPP) -c error.cpp -o error.o $(CXXFLAGS)</tt></b></p>
</td>
</tr>
</table>

<p><img src="bullet.gif" height="18" width="20"> Поделяне на променливи и константи
между модули.
<br>    Функции/класове се използват от няколко модула като
се декларират/дефинират в заглавни файлове и тези файлове се включват с
директивата на препроцесора
<b><tt>#include</tt></b>. Такава техника се
използва и за поделяне на константи и променливи, дефинирани в заглавни
файлове. Когато константа или променлива е дефинирана в някой .<b><tt>cpp</tt></b>
файл и трябва да се използва от други модули, тя се дефинира там като външен
обект (с ключовата дума
<b><tt>extern</tt></b>).
<br>Пример.
<br><b><tt><font color="#006600">// файл first.cpp</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">int global_size;</font></tt></b>
<br><b><tt><font color="#006600">void f()</font></tt></b>
<br><b><tt><font color="#006600">{ cout &lt;&lt; global_ size;</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><b><tt><font color="#006600">// файл second.cpp</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">extern int global_size;</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">int main()</font></tt></b>
<br><b><tt><font color="#006600">{ global_size = 100;</font></tt></b>
<br><b><tt><font color="#006600">...</font></tt></b>
<br><b><tt><font color="#006600">}</font></tt></b>
<br><font color="#000000">Следва разделна компилация на двата файла (модула)
и свързването им в една програма.</font>
</p>
<p>
</p>
<hr width="100%">
</body>
</html>
