<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
   <meta name="Author" content="Nikolay Kirov">
   <meta name="GENERATOR" content="Mozilla/4.75 [en] (Win98; U) [Netscape]">
   <title>l20</title>
</head>
<body>

<center>
<h3>
<b>20. Реализация на свързани списъци</b></h3></center>

<div align=right><i>This method is to define as the number of a class,</i>
<br><i>the class of all classes similar to the given class.</i>
<br><i>Bertrand Russell</i></div>
<i></i>
<p><img SRC="bullet.gif" height=18 width=20>&nbsp; Реализация на свързани
списъци - класове, итератори,&nbsp; операции.
<br>&nbsp;&nbsp;&nbsp; Ще напишем класове, подобни на стандартните <b><tt>list&lt;string></tt></b>
и <b><tt>list&lt;string>::iterator</tt></b> (вж 19. Въведение в структурите
от данни).
<br><b><tt><font color="#000099">// list2.cpp</font></tt></b>
<br><b><tt><font color="#000099">#include &lt;string></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;iostream></font></tt></b>
<br><b><tt><font color="#000099">#include &lt;cassert></font></tt></b>
<br><b><tt><font color="#000099">using namespace std;</font></tt></b>
<p><b><tt>/* <font color="#993300">декларации на класовете List и Iterator
за да могат да бъдат използвани при дефиниране на List</font>*/</tt></b>
<br><b><tt><font color="#000099">class List;</font></tt></b>
<br><b><tt><font color="#000099">class Iterator;</font></tt></b>
<br><b><tt>/* <font color="#993300">елемент на свързания списък</font>
*/</tt></b>
<br><b><tt><font color="#000099">class Link {</font></tt></b>
<br><b><tt><font color="#000099">public:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link(string);</font></tt></b>
<br><b><tt><font color="#000099">private:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; string data;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* previous;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* next;</font></tt></b>
<br><b><tt><font color="#000099">/* член-функциите на класовете List и
Iterator имат достъп до частните членове на класа Link */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; friend class List;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; friend class Iterator;</font></tt></b>
<br><b><tt><font color="#000099">};</font></tt></b>
<p><b><tt><font color="#000099">class List {</font></tt></b>
<br><b><tt><font color="#000099">public:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; List();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; void push_back(string);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; void insert(Iterator, string);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; void erase(Iterator);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Iterator begin(); /* начало
на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Iterator end();&nbsp;&nbsp;
/* край на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">private:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* first;&nbsp; /* първи
елемент на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* last;&nbsp;&nbsp; /*
последен елемент на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">};</font></tt></b>
<p><b><tt><font color="#000099">class Iterator {</font></tt></b>
<br><b><tt><font color="#000099">public:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Iterator();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; string get() const; /* реализира
операция * за итератори */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; void next();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* реализира операция ++ за итератори */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; void previous();&nbsp;&nbsp;&nbsp;
/* реализира операция -- за итератори */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; bool not_equal(Iterator)
const; /* реализира операция != */</font></tt></b>
<br><b><tt><font color="#000099">private:</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* position; /* текущ
елемент на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; Link* last;&nbsp;&nbsp;&nbsp;&nbsp;
/* последен елемент на свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">/* член-функциите на класа List имат достъп
до частните членове на Iterator */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; friend class List;</font></tt></b>
<br><b><tt><font color="#000099">};</font></tt></b>
<p><b><tt><font color="#000099">Link::Link(string s)</font></tt></b>
<br><b><tt><font color="#000099">/* ПОЛУЧАВА: s - данната, която ще се
съхранява в този елемент */</font></tt></b>
<br><b><tt><font color="#000099">{ data = s;&nbsp; previous = NULL;&nbsp;
next = NULL; }</font></tt></b>
<p><b><tt><font color="#000099">List::List()</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: </font>конструира празен свързан
списък */</tt></b>
<br><b><tt><font color="#000099">{ first = NULL; last = NULL; }</font></tt></b>
<p><b><tt><font color="#000099">void List::push_back(string s)</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: добавя елемент към свързан спесък</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; ПОЛУЧАВА: s - данната, която
ще се добави</font></tt></b>
<br><b><tt><font color="#000099">*/</font></tt></b>
<br><b><tt><font color="#000099">{ Link* newlink = new Link(s);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (last == NULL)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/* </font>празен свързан списък<font color="#000099"> */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { first = newlink; last = newlink;
}</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { newlink->previous = last;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; last->next = newlink;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp; last = newlink;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; }</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void List::insert(Iterator iter, string
s)</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: вмъква елемент в свързан спесък</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; ПОЛУЧАВА: iter - позицията,
преди която да се вмъкне</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
s - данната, която ще се вмъкне</font></tt></b>
<br><b><tt><font color="#000099">*/</font></tt></b>
<br><b><tt><font color="#000099">{ if (iter.position == NULL) /* вмъкване
в края */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; { push_back(s);&nbsp; return;&nbsp;
}</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* after = iter.position;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* before = after->previous;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* newlink = new Link(s);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; newlink->previous = before;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; newlink->next = after;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; after->previous = newlink;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (before == NULL) first = newlink;
/* вмъкване в началото */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
before->next = newlink;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void List::erase(Iterator iter)</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: отстранява елемент от свързан
спесък</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; ПОЛУЧАВА: iter - позицията
на елемента, който ще се отстрани</font></tt></b>
<br><b><tt><font color="#000099">*/</font></tt></b>
<br><b><tt><font color="#000099">{ assert(iter.position != NULL);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* remove = iter.position;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* before = remove->previous;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Link* after = remove->next;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (remove == first) first = after;/*
изтриване на първия елемент */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
before->next = after;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; if (remove == last)&nbsp; last
= before;/* изтриване на последния елемент */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
after->previous = before;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; iter.position = after;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; delete remove;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">Iterator List::begin()</font></tt></b>
<br><b><tt><font color="#000099">/* ВРЪЩА: итератор, сочещ към началната
позиция на свързан списък */</font></tt></b>
<br><b><tt><font color="#000099">{ Iterator iter;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; iter.position = first;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; iter.last = last;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return iter;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">Iterator List::end()</font></tt></b>
<br><b><tt><font color="#000099">/* ВРЪЩА: итератор, сочещ след края на
списъка (NULL) */</font></tt></b>
<br><b><tt><font color="#000099">{ Iterator iter;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; iter.position = NULL;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; iter.last = last;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return iter;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">Iterator::Iterator()</font></tt></b>
<br><b><tt><font color="#000099">{&nbsp; position = NULL;&nbsp;&nbsp; last
= NULL;&nbsp; }</font></tt></b>
<p><b><tt><font color="#000099">string Iterator::get() const</font></tt></b>
<br><b><tt><font color="#000099">/* ВРЪЩА: данната на елемента, който сочи
итератора */</font></tt></b>
<br><b><tt><font color="#000099">{ assert(position != NULL);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return position->data;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void Iterator::next()</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: да премести итератора на следващия
елемент от списъка */</font></tt></b>
<br><b><tt><font color="#000099">{ assert(position != NULL);</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; position = position->next;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">void Iterator::previous()</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: да премести итератора на предишния
елемент от списъка */</font></tt></b>
<br><b><tt><font color="#000099">{ if (position == NULL)&nbsp; position
= last;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; else&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
position = position->previous;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; assert(position != NULL);</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<p><b><tt><font color="#000099">bool Iterator::not_equal(Iterator b) const</font></tt></b>
<br><b><tt><font color="#000099">/* ЦЕЛ: сравнява два итератора</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; ПОЛУЧАВА: b - вторият итератор
за сравнението</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp; ВРЪЩА: true ако този итератор
и b не са равни</font></tt></b>
<br><b><tt><font color="#000099">*/</font></tt></b>
<br><b><tt><font color="#000099">{ return position != b.position; }</font></tt></b>
<p><b><tt><font color="#000099">int main()</font></tt></b>
<br><b><tt><font color="#000099">{ List staff;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.push_back("Cracker, Carl");</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.push_back("Hacker, Harry");</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.push_back("Lam, Larry");</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.push_back("Sandman, Susan");</font></tt></b>
<p><b><tt><font color="#000099">/* добавя елемент на четвърто място */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; Iterator pos;</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; pos = staff.begin();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; pos.next();&nbsp;&nbsp; pos.next();&nbsp;&nbsp;
pos.next();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.insert(pos, "Reindeer, Rudolf");</font></tt></b>
<p><b><tt><font color="#000099">/* отстранява втория елемент */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; pos = staff.begin();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; pos.next();</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; staff.erase(pos);</font></tt></b>
<p><b><tt><font color="#000099">/* отпечатва свързания списък */</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; for (pos = staff.begin(); pos.not_equal(staff.end());</font></tt></b>
<br><b><tt><font color="#000099">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pos.next())
cout &lt;&lt; pos.get() &lt;&lt; "\n";</font></tt></b>
<br><b><tt><font color="#000099">&nbsp; return 0;</font></tt></b>
<br><b><tt><font color="#000099">}</font></tt></b>
<table BORDER CELLPADDING=4 WIDTH="100%" >
<tr>
<td><b><tt><font color="#993300">Cracker, Carl</font></tt></b>
<br><b><tt><font color="#993300">Lam, Larry</font></tt></b>
<br><b><tt><font color="#993300">Reindeer, Rudolf</font></tt></b>
<br><b><tt><font color="#993300">Sandman, Susan</font></tt></b></td>
</tr>
</table>

<p>Начално състояние на списъка:
<table COLS=5 WIDTH="100%" >
<tr>
<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Cracker, Carl</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Hacker, Harry</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Lam, Larry</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Sandman, Susan</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>
</table>
</td>

<td></td>
</tr>
</table>

<p><font color="#000000">След добавяне на елемент на четвърто място:</font>
<table COLS=5 WIDTH="100%" >
<tr>
<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Cracker, Carl</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Hacker, Harry</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Lam, Larry</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Reindeer, Rudolf</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Sandman, Susan</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>
</table>
</td>
</tr>
</table>

<p><font color="#000000">След отстраняване на втория елемент:</font>
<table COLS=5 WIDTH="100%" >
<tr>
<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Cracker, Carl</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Lam, Larry</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Reindeer, Rudolf</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">-></font></tt></b></td>
</tr>
</table>
</td>

<td>
<table BORDER CELLSPACING=0 CELLPADDING=2 WIDTH="100%" >
<tr>
<td><b><tt><font color="#000099">Sandman, Susan</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">&lt;-</font></tt></b></td>
</tr>

<tr>
<td><b><tt><font color="#000099">NULL</font></tt></b></td>
</tr>
</table>
</td>

<td></td>
</tr>
</table>

<hr WIDTH="100%">
</body>
</html>
